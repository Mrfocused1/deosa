<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="images/logo-light.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard | De'Osa Catering</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#FDFBF7',
                        charcoal: '#1C1C1C',
                        gold: '#C5A059',
                        'gold-light': '#E8D3A2',
                        sand: '#F4F1EA',
                        success: '#2E5C3A',
                        warning: '#8B5A2B',
                        danger: '#8B2B2B'
                    },
                    fontFamily: {
                        serif: ['"Cormorant Garamond"', 'serif'],
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        :root {
            --cream: #FDFBF7;
            --charcoal: #1C1C1C;
            --gold: #C5A059;
            --sand: #F4F1EA;
            --success: #2E5C3A;
            --warning: #8B5A2B;
            --danger: #8B2B2B;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--charcoal);
            color: var(--cream);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 4px; }

        /* Noise texture */
        .noise::before {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg fill='%23FDFBF7' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position-x: 95%;
            background-position-y: center;
            background-color: transparent;
        }

        /* Badges — dark bg adjusted */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .badge-paid    { background: rgba(46,92,58,0.25);   color: #6FCF97; border: 1px solid rgba(46,92,58,0.5); }
        .badge-pending { background: rgba(197,160,89,0.15); color: var(--gold); border: 1px solid rgba(197,160,89,0.35); }
        .badge-sent    { background: rgba(99,179,237,0.15); color: #90CDF4; border: 1px solid rgba(99,179,237,0.3); }
        .badge-neutral { background: rgba(253,251,247,0.08); color: rgba(253,251,247,0.4); border: 1px solid rgba(253,251,247,0.15); }

        /* Card style matching login */
        .dash-card {
            background: rgba(253,251,247,0.04);
            border: 1px solid rgba(253,251,247,0.1);
            border-radius: 0.75rem;
            transition: border-color 0.3s ease;
        }
        .dash-card:hover { border-color: rgba(197,160,89,0.25); }

        /* Sidebar nav active */
        .nav-active {
            background: rgba(197,160,89,0.12);
            color: var(--gold);
            border: 1px solid rgba(197,160,89,0.25);
        }
        .nav-inactive {
            color: rgba(253,251,247,0.45);
            border: 1px solid transparent;
        }
        .nav-inactive:hover {
            color: rgba(253,251,247,0.85);
            background: rgba(253,251,247,0.05);
        }

        /* Drawer */
        .drawer-open   { transform: translateX(0%); }
        .drawer-closed { transform: translateX(100%); }

        /* ─── Dark mode: boost all cream text to pure white with higher opacities ─── */
        .text-cream         { color: #FFFFFF !important; }
        .text-cream\/80     { color: rgba(255,255,255,0.92) !important; }
        .text-cream\/70     { color: rgba(255,255,255,0.82) !important; }
        .text-cream\/60     { color: rgba(255,255,255,0.74) !important; }
        .text-cream\/55     { color: rgba(255,255,255,0.68) !important; }
        .text-cream\/50     { color: rgba(255,255,255,0.64) !important; }
        .text-cream\/45     { color: rgba(255,255,255,0.58) !important; }
        .text-cream\/40     { color: rgba(255,255,255,0.54) !important; }
        .text-cream\/35     { color: rgba(255,255,255,0.47) !important; }
        .text-cream\/30     { color: rgba(255,255,255,0.42) !important; }
        .text-cream\/25     { color: rgba(255,255,255,0.36) !important; }
        .text-cream\/20     { color: rgba(255,255,255,0.30) !important; }
        .text-cream\/15     { color: rgba(255,255,255,0.23) !important; }

        /* ─── Light Mode ─── */
        html[data-theme="light"] body {
            background-color: #F0EDE6;
            color: #000000;
        }
        html[data-theme="light"] aside {
            background-color: #FDFBF7;
            border-right-color: rgba(0,0,0,0.12) !important;
        }
        html[data-theme="light"] aside .border-b { border-color: rgba(0,0,0,0.09) !important; }
        html[data-theme="light"] .nav-inactive { color: rgba(0,0,0,0.55) !important; border-color: transparent !important; }
        html[data-theme="light"] .nav-inactive:hover { color: rgba(0,0,0,0.88) !important; background: rgba(0,0,0,0.05) !important; }
        html[data-theme="light"] .nav-active { background: rgba(197,160,89,0.12) !important; color: #C5A059 !important; border-color: rgba(197,160,89,0.25) !important; }
        html[data-theme="light"] main > header { border-bottom-color: rgba(0,0,0,0.1) !important; }
        html[data-theme="light"] #mobile-menu { background: #FDFBF7 !important; }
        html[data-theme="light"] #global-search { background: rgba(0,0,0,0.06) !important; border-color: rgba(0,0,0,0.14) !important; color: #000000 !important; }
        html[data-theme="light"] #global-search::placeholder { color: rgba(0,0,0,0.38) !important; }
        html[data-theme="light"] .dash-card { background: rgba(253,251,247,0.9) !important; border-color: rgba(0,0,0,0.1) !important; }
        html[data-theme="light"] .dash-card:hover { border-color: rgba(197,160,89,0.35) !important; }
        html[data-theme="light"] .badge-neutral { background: rgba(0,0,0,0.06) !important; color: rgba(0,0,0,0.55) !important; border-color: rgba(0,0,0,0.14) !important; }
        html[data-theme="light"] select {
            background-image: url("data:image/svg+xml;utf8,<svg fill='%23000000' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>") !important;
            color: rgba(0,0,0,0.82) !important;
            border-color: rgba(0,0,0,0.14) !important;
        }
        html[data-theme="light"] #crm-table-body tr { border-color: rgba(0,0,0,0.07) !important; }
        html[data-theme="light"] #crm-table-body tr:hover { background: rgba(0,0,0,0.03) !important; }
        html[data-theme="light"] #transcript-drawer { background: #F0EDE6 !important; border-left-color: rgba(0,0,0,0.1) !important; }
        html[data-theme="light"] #comms-sheet { background: #F0EDE6 !important; border-top-color: rgba(197,160,89,0.2) !important; }
        /* Light mode — all cream text variants → near-black */
        html[data-theme="light"] .text-cream         { color: #000000 !important; }
        html[data-theme="light"] .text-cream\/80     { color: rgba(0,0,0,0.85) !important; }
        html[data-theme="light"] .text-cream\/70     { color: rgba(0,0,0,0.76) !important; }
        html[data-theme="light"] .text-cream\/60     { color: rgba(0,0,0,0.68) !important; }
        html[data-theme="light"] .text-cream\/55     { color: rgba(0,0,0,0.62) !important; }
        html[data-theme="light"] .text-cream\/50     { color: rgba(0,0,0,0.58) !important; }
        html[data-theme="light"] .text-cream\/45     { color: rgba(0,0,0,0.53) !important; }
        html[data-theme="light"] .text-cream\/40     { color: rgba(0,0,0,0.48) !important; }
        html[data-theme="light"] .text-cream\/35     { color: rgba(0,0,0,0.44) !important; }
        html[data-theme="light"] .text-cream\/30     { color: rgba(0,0,0,0.40) !important; }
        html[data-theme="light"] .text-cream\/25     { color: rgba(0,0,0,0.35) !important; }
        html[data-theme="light"] .text-cream\/20     { color: rgba(0,0,0,0.30) !important; }
        html[data-theme="light"] .text-cream\/15     { color: rgba(0,0,0,0.24) !important; }
        html[data-theme="light"] .border-cream\/10   { border-color: rgba(0,0,0,0.10) !important; }
        html[data-theme="light"] .border-cream\/15   { border-color: rgba(0,0,0,0.15) !important; }
        html[data-theme="light"] .border-cream\/20   { border-color: rgba(0,0,0,0.20) !important; }
        html[data-theme="light"] .bg-cream\/5        { background-color: rgba(0,0,0,0.05) !important; }
        html[data-theme="light"] .bg-cream\/8        { background-color: rgba(0,0,0,0.06) !important; }
        html[data-theme="light"] .bg-cream\/\[0\.03\] { background-color: rgba(0,0,0,0.03) !important; }
        /* Theme toggle button */
        .theme-toggle { transition: color 0.2s, background 0.2s; }

        /* ── Call Log intake form ── */
        .cl-input {
            width: 100%;
            background: rgba(253,251,247,0.04);
            border: 1px solid rgba(253,251,247,0.1);
            border-radius: 0.5rem;
            padding: 0.6rem 0.875rem;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.75rem;
            color: #FDFBF7;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .cl-input:focus { border-color: rgba(197,160,89,0.5); box-shadow: 0 0 0 2px rgba(197,160,89,0.08); }
        .cl-input::placeholder { color: rgba(253,251,247,0.2); }
        select.cl-input {
            background-image: url("data:image/svg+xml;utf8,<svg fill='%23FDFBF7' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat; background-position: right 0.75rem center;
            -webkit-appearance: none; appearance: none;
        }
        textarea.cl-input { resize: vertical; }
        .cl-label {
            display: block;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.6rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.18em;
            color: rgba(253,251,247,0.35); margin-bottom: 0.4rem;
        }
        .cl-section { padding-bottom: 1.25rem; margin-bottom: 1.25rem; border-bottom: 1px solid rgba(253,251,247,0.07); }
        .cl-section-hd {
            font-family: 'Montserrat', sans-serif;
            font-size: 0.6rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.22em;
            color: #C5A059; margin-bottom: 0.875rem;
        }
        .cl-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.875rem; }
        @media (max-width: 560px) { .cl-grid-2 { grid-template-columns: 1fr; } }
    </style>
</head>
<body class="noise selection:bg-gold selection:text-charcoal flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 flex-col hidden md:flex shrink-0 z-20 border-r border-cream/10 relative">
        <!-- Logo -->
        <div class="p-8 border-b border-cream/10">
            <a href="index.html"><img id="sidebar-logo" src="images/logo-dark-bg.svg" alt="De'Osa" class="h-8 w-auto"></a>
            <p class="font-sans text-[10px] tracking-[0.25em] uppercase text-cream/40 mt-3">Staff Dashboard</p>
        </div>

        <!-- Nav -->
        <nav class="flex-1 px-4 py-8 space-y-1 font-sans text-xs font-medium">
            <a href="index.html" class="flex items-center gap-4 px-4 py-3 rounded-lg nav-inactive transition-all">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <span class="tracking-widest uppercase text-[10px]">Home</span>
            </a>
            <a href="#" class="flex items-center gap-4 px-4 py-3 rounded-lg nav-active transition-all">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
                <span class="tracking-widest uppercase text-[10px]">Call CRM</span>
            </a>
            <a href="menus-pricing.html" class="flex items-center gap-4 px-4 py-3 rounded-lg nav-inactive transition-all">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span class="tracking-widest uppercase text-[10px]">Menus & Pricing</span>
            </a>
            <a href="event-calendar.html" class="flex items-center gap-4 px-4 py-3 rounded-lg nav-inactive transition-all">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                <span class="tracking-widest uppercase text-[10px]">Event Calendar</span>
            </a>
            <a href="settings.html" class="flex items-center gap-4 px-4 py-3 rounded-lg nav-inactive transition-all">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                <span class="tracking-widest uppercase text-[10px]">Settings</span>
            </a>
        </nav>

        <!-- User -->
        <div class="p-5 border-t border-cream/10 flex items-center gap-3">
            <div class="w-9 h-9 rounded-full bg-gold flex items-center justify-center text-charcoal font-serif text-lg shrink-0">D</div>
            <div>
                <p class="font-sans text-xs font-semibold text-cream">De'Osa Admin</p>
                <p class="font-sans text-[10px] text-cream/40 tracking-widest uppercase">Director</p>
            </div>
            <a href="login.html" class="ml-auto text-cream/30 hover:text-gold transition-colors" title="Sign out">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
            </a>
        </div>
    </aside>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 z-50 flex flex-col justify-center items-center gap-8 transition-all duration-500 opacity-0 pointer-events-none" style="background:#111111;">
        <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 font-sans text-xs font-bold tracking-widest uppercase text-cream/50 hover:text-gold transition-colors border border-cream/10 px-4 py-2 rounded-full">Close</button>

        <div class="text-center mb-4">
            <img id="mobile-logo" src="images/logo-dark-bg.svg" alt="De'Osa" class="h-10 w-auto mx-auto">
            <p class="font-sans text-[10px] tracking-[0.25em] uppercase text-cream/30 mt-3">Staff Dashboard</p>
        </div>

        <nav class="flex flex-col items-center gap-3 w-full max-w-xs">
            <a href="index.html" class="w-full flex items-center gap-4 px-6 py-4 rounded-xl nav-inactive transition-all justify-center">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <span class="font-sans text-xs font-bold tracking-widest uppercase">Home</span>
            </a>
            <a href="#" class="w-full flex items-center gap-4 px-6 py-4 rounded-xl nav-active transition-all text-center justify-center" onclick="toggleMobileMenu()">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
                <span class="font-sans text-xs font-bold tracking-widest uppercase">Call CRM</span>
            </a>
            <a href="menus-pricing.html" class="w-full flex items-center gap-4 px-6 py-4 rounded-xl nav-inactive transition-all justify-center" onclick="toggleMobileMenu()">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span class="font-sans text-xs font-bold tracking-widest uppercase">Menus & Pricing</span>
            </a>
            <a href="event-calendar.html" class="w-full flex items-center gap-4 px-6 py-4 rounded-xl nav-inactive transition-all justify-center" onclick="toggleMobileMenu()">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                <span class="font-sans text-xs font-bold tracking-widest uppercase">Event Calendar</span>
            </a>
            <a href="settings.html" class="w-full flex items-center gap-4 px-6 py-4 rounded-xl nav-inactive transition-all justify-center">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                <span class="font-sans text-xs font-bold tracking-widest uppercase">Settings</span>
            </a>
        </nav>

        <a href="login.html" class="font-sans text-xs font-bold tracking-widest uppercase text-cream/30 hover:text-gold transition-colors mt-4 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
            Sign Out
        </a>
    </div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden relative z-10">

        <!-- Topbar -->
        <header class="border-b border-cream/10 h-16 md:h-20 flex items-center justify-between px-5 md:px-8 shrink-0">

            <!-- Mobile: logo + hamburger -->
            <div class="flex items-center gap-3 md:hidden">
                <button onclick="toggleMobileMenu()" class="text-cream/60 hover:text-gold transition-colors p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
                <a href="index.html" class="font-serif text-xl tracking-widest uppercase text-gold">De'Osa</a>
            </div>

            <!-- Desktop: page title -->
            <div class="hidden md:block">
                <h2 class="font-serif text-3xl text-cream">Interaction CRM</h2>
            </div>

            <div class="flex-1 max-w-md ml-4 md:ml-6 relative">
                <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-cream/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                <input type="text" id="global-search" placeholder="Search..." class="w-full bg-cream/5 border border-cream/10 rounded-full py-2 pl-9 pr-4 focus:outline-none focus:border-gold/50 focus:ring-1 focus:ring-gold/30 transition-all font-sans text-xs text-cream placeholder-cream/30">
            </div>

            <button class="ml-3 md:ml-4 relative p-2 text-cream/40 hover:text-gold transition-colors shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
                <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-gold rounded-full"></span>
            </button>

            <!-- Light / Dark toggle -->
            <button id="theme-toggle" onclick="toggleTheme()" class="theme-toggle ml-1 p-2 text-cream/40 hover:text-gold transition-colors shrink-0" title="Toggle light/dark mode">
                <!-- Moon — shown in dark mode -->
                <svg id="theme-icon-moon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
                <!-- Sun — shown in light mode -->
                <svg id="theme-icon-sun" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-9h-1M4.34 12h-1m15.07-6.07-.71.71M6.34 17.66l-.71.71m12.73 0-.71-.71M6.34 6.34l-.71-.71M12 5a7 7 0 100 14A7 7 0 0012 5z"/></svg>
            </button>
        </header>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-6 md:p-8 space-y-8">

            <!-- Metrics -->
            <div class="space-y-4">

                <!-- Period Filter -->
                <div class="flex items-center justify-between">
                    <p class="font-sans text-[10px] uppercase tracking-widest text-cream/30 font-medium">Overview</p>
                    <div id="metric-period-bar" class="flex gap-1.5">
                        <button class="metric-period font-sans text-[10px] font-bold uppercase tracking-widest px-3.5 py-1.5 rounded-full border transition-all" data-period="today">Today</button>
                        <button class="metric-period font-sans text-[10px] font-bold uppercase tracking-widest px-3.5 py-1.5 rounded-full border transition-all" data-period="week">This Week</button>
                        <button class="metric-period font-sans text-[10px] font-bold uppercase tracking-widest px-3.5 py-1.5 rounded-full border transition-all" data-period="month">This Month</button>
                    </div>
                </div>

                <!-- Cards -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">

                    <div class="dash-card p-6 flex items-center justify-between">
                        <div>
                            <p class="font-sans text-[10px] uppercase tracking-widest text-cream/50 font-medium mb-2">Total Calls</p>
                            <p id="metric-calls" class="font-serif text-4xl text-cream">18</p>
                            <p id="metric-calls-sub" class="font-sans text-[10px] text-cream/30 mt-1">Today</p>
                        </div>
                        <div class="w-11 h-11 rounded-full bg-gold/10 border border-gold/20 flex items-center justify-center text-gold shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                        </div>
                    </div>

                    <div class="dash-card p-6 flex items-center justify-between">
                        <div>
                            <p class="font-sans text-[10px] uppercase tracking-widest text-cream/50 font-medium mb-2">Confirmed</p>
                            <p id="metric-confirmed" class="font-serif text-4xl text-cream">3</p>
                            <p class="font-sans text-[10px] text-cream/30 mt-1">Bookings</p>
                        </div>
                        <div class="w-11 h-11 rounded-full bg-green-500/10 border border-green-500/20 flex items-center justify-center text-green-400 shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        </div>
                    </div>

                    <div class="dash-card p-6 flex items-center justify-between">
                        <div>
                            <p class="font-sans text-[10px] uppercase tracking-widest text-cream/50 font-medium mb-2">Invoices</p>
                            <p id="metric-invoices" class="font-serif text-4xl text-cream">7</p>
                            <p class="font-sans text-[10px] text-cream/30 mt-1">Sent</p>
                        </div>
                        <div class="w-11 h-11 rounded-full bg-blue-500/10 border border-blue-500/20 flex items-center justify-center text-blue-300 shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        </div>
                    </div>

                    <div class="dash-card p-6 flex items-center justify-between">
                        <div>
                            <p class="font-sans text-[10px] uppercase tracking-widest text-cream/50 font-medium mb-2">Pending</p>
                            <p id="metric-pending" class="font-serif text-4xl text-cream">£2,100</p>
                            <p class="font-sans text-[10px] text-cream/30 mt-1">Payments</p>
                        </div>
                        <div class="w-11 h-11 rounded-full bg-gold/10 border border-gold/20 flex items-center justify-center text-gold shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                    </div>

                </div>
            </div>

            <!-- ───────────── Call Log ───────────── -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="font-sans text-[10px] uppercase tracking-widest text-cream/30 font-medium">Recent</p>
                        <h3 class="font-serif text-2xl text-cream">Call Log</h3>
                    </div>
                    <button onclick="openNewCall()" class="flex items-center gap-2 px-4 py-2.5 bg-gold/20 border border-gold/40 text-gold rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:bg-gold hover:text-charcoal transition-all shrink-0">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                        New Call
                    </button>
                </div>
                <div id="call-log-list" class="space-y-2"><!-- populated by JS --></div>
            </div>

            <!-- Table Controls -->
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <div>
                    <p class="font-sans text-[10px] uppercase tracking-widest text-cream/40 mb-1">Overview</p>
                    <h3 class="font-serif text-2xl text-cream">Recent Interactions</h3>
                </div>
                <div class="flex flex-wrap gap-3 w-full sm:w-auto">
                    <select id="filter-date" class="dash-card border border-cream/10 text-cream/70 text-xs font-sans py-2 pl-4 pr-10 rounded-lg focus:outline-none focus:border-gold/40 w-full sm:w-auto">
                        <option value="all">All Dates</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                    <select id="filter-outcome" class="dash-card border border-cream/10 text-cream/70 text-xs font-sans py-2 pl-4 pr-10 rounded-lg focus:outline-none focus:border-gold/40 w-full sm:w-auto">
                        <option value="all">All Outcomes</option>
                        <option value="Booking Confirmed">Booking Confirmed</option>
                        <option value="Quote Requested">Quote Requested</option>
                        <option value="Tasting Scheduled">Tasting Scheduled</option>
                        <option value="Information Sent">Information Sent</option>
                    </select>
                    <select id="filter-invoice" class="dash-card border border-cream/10 text-cream/70 text-xs font-sans py-2 pl-4 pr-10 rounded-lg focus:outline-none focus:border-gold/40 w-full sm:w-auto">
                        <option value="all">All Invoices</option>
                        <option value="Paid">Paid</option>
                        <option value="Sent">Sent (Pending)</option>
                        <option value="To Be Sent">To Be Sent</option>
                    </select>
                    <select id="sort-calls" class="dash-card border border-gold/30 text-gold text-xs font-sans py-2 pl-4 pr-10 rounded-lg focus:outline-none focus:border-gold/60 w-full sm:w-auto">
                        <option value="default">Default Order</option>
                        <option value="recent">Most Recent</option>
                        <option value="longest">Longest Calls</option>
                        <option value="shortest">Shortest Calls</option>
                    </select>
                </div>
            </div>

            <!-- Main Data Table -->
            <div class="dash-card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse min-w-[900px]">
                        <thead>
                            <tr class="border-b border-cream/10 font-sans text-xs uppercase tracking-widest text-cream/40">
                                <th class="p-4 py-5 font-medium">Client / Contact</th>
                                <th class="p-4 py-5 font-medium">Event & Order</th>
                                <th class="p-4 py-5 font-medium">Call Interaction</th>
                                <th class="p-4 py-5 font-medium">Communications</th>
                                <th class="p-4 py-5 font-medium text-right">Billing</th>
                            </tr>
                        </thead>
                        <tbody id="crm-table-body" class="font-sans text-sm divide-y divide-cream/5">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div id="no-data-msg" class="hidden flex-col items-center justify-center py-16">
                    <svg class="w-10 h-10 text-cream/15 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    <p class="text-cream/30 font-sans text-sm">No records found matching your criteria.</p>
                </div>
            </div>

            <!-- Pagination -->
            <div class="flex justify-between items-center">
                <p class="font-sans text-xs text-cream/30">Showing 1 to <span id="visible-count">5</span> of 5 entries</p>
                <div class="flex gap-2">
                    <button class="px-3 py-1.5 border border-cream/10 rounded text-cream/30 cursor-not-allowed font-sans text-xs">&lt;</button>
                    <button class="px-3 py-1.5 border border-gold bg-gold/20 text-gold rounded font-sans text-xs font-bold">1</button>
                    <button class="px-3 py-1.5 border border-cream/10 rounded text-cream/50 hover:border-gold/30 hover:text-cream font-sans text-xs transition-colors">&gt;</button>
                </div>
            </div>

        </div>
    </main>

    <!-- Transcript Overlay -->
    <div id="transcript-overlay" class="fixed inset-0 bg-charcoal/70 z-40 hidden transition-opacity opacity-0 backdrop-blur-sm" onclick="closeTranscript()"></div>

    <!-- Transcript Drawer -->
    <div id="transcript-drawer" class="fixed top-0 right-0 h-full w-full max-w-lg z-50 drawer-closed transition-transform duration-300 flex flex-col border-l border-cream/10" style="background: #161616;">

        <!-- Drawer Header -->
        <div class="p-6 border-b border-cream/10 flex justify-between items-center shrink-0">
            <div>
                <h3 class="font-serif text-2xl text-cream">Interaction Details</h3>
                <p id="drawer-client-name" class="font-sans text-xs text-cream/40 font-light mt-1 tracking-wider"></p>
            </div>
            <button onclick="closeTranscript()" class="p-2 rounded-full text-cream/40 hover:text-gold hover:bg-cream/5 transition-colors border border-cream/10">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <!-- Drawer Content -->
        <div class="flex-1 overflow-y-auto p-6 space-y-8">

            <!-- Contact Details -->
            <div class="dash-card p-5">
                <p class="font-sans text-[10px] uppercase tracking-widest text-gold/70 mb-4">Contact Details</p>
                <div class="space-y-4">
                    <div class="flex items-center gap-3">
                        <svg class="w-4 h-4 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        <span id="drawer-contact-name" class="text-cream/80 text-sm font-light">—</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <svg class="w-4 h-4 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                        <span id="drawer-email" class="text-cream/80 text-sm font-light">—</span>
                    </div>
                </div>
            </div>

            <!-- Call Details -->
            <div class="dash-card p-5">
                <p class="font-sans text-[10px] uppercase tracking-widest text-gold/70 mb-4">Call Details</p>
                <div class="space-y-3">
                    <div class="flex items-center gap-3">
                        <svg class="w-4 h-4 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        <span id="drawer-call-date" class="text-cream/80 text-sm font-light">—</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <svg class="w-4 h-4 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span id="drawer-call-duration" class="text-cream/80 text-sm font-light">—</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <svg class="w-4 h-4 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span id="drawer-call-outcome" class="text-cream/80 text-sm font-light">—</span>
                    </div>
                </div>
            </div>

            <!-- Call Recording Section (shown only when a convId is available) -->
            <div id="drawer-recording-section" class="hidden dash-card p-5">
                <p class="font-sans text-[10px] uppercase tracking-widest text-gold/70 mb-4">Call Recording</p>
                <audio id="drawer-audio-el"></audio>
                <div class="flex items-center gap-3">
                    <button id="drawer-play-btn" onclick="toggleDrawerAudio()" class="w-10 h-10 rounded-full bg-cream/8 border border-cream/15 flex items-center justify-center text-cream/70 hover:border-gold/40 hover:text-gold transition-colors shrink-0">
                        <svg id="drawer-play-icon" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <svg id="drawer-pause-icon" class="w-4 h-4 hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </button>
                    <div class="flex-1">
                        <div class="w-full bg-cream/10 rounded-full h-1.5 cursor-pointer" id="drawer-progress-bar" onclick="seekDrawerAudio(event)">
                            <div id="drawer-progress-fill" class="bg-gold/70 h-1.5 rounded-full transition-none" style="width:0%"></div>
                        </div>
                        <div class="flex justify-between mt-1.5">
                            <span id="drawer-elapsed" class="font-sans text-[10px] text-cream/30">0:00</span>
                            <span id="drawer-total" class="font-sans text-[10px] text-cream/30">—</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transcript Section (shown only when a convId is available) -->
            <div id="drawer-transcript-section" class="hidden">
                <p class="font-sans text-[10px] uppercase tracking-widest text-gold/70 mb-4">Call Transcript</p>
                <div id="drawer-transcript-messages" class="space-y-3">
                    <!-- Chat bubbles populated dynamically -->
                </div>
            </div>

            <!-- Actions -->
            <div class="pt-6 border-t border-cream/10 flex gap-3">
                <button class="flex-1 py-3 bg-cream/5 border border-cream/15 text-cream/60 rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:border-cream/30 hover:text-cream transition-all">Download PDF</button>
                <button class="flex-1 py-3 bg-gold/20 border border-gold/40 text-gold rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:bg-gold hover:text-charcoal transition-all">Email to Staff</button>
            </div>
        </div>
    </div>

    <!-- Invoice Overlay -->
    <div id="invoice-overlay" class="fixed inset-0 bg-charcoal/70 z-40 hidden opacity-0 transition-opacity backdrop-blur-sm" onclick="closeInvoice()"></div>

    <!-- Invoice Drawer -->
    <div id="invoice-drawer" class="fixed top-0 right-0 h-full w-full max-w-lg z-50 drawer-closed transition-transform duration-300 flex flex-col border-l border-charcoal/10 overflow-y-auto" style="background:#FDFBF7;">

        <!-- Header -->
        <div class="p-6 border-b border-charcoal/10 flex justify-between items-center shrink-0">
            <div>
                <h3 class="font-serif text-2xl text-charcoal">Invoice</h3>
                <p id="invoice-ref" class="font-sans text-xs text-charcoal mt-1">#DOC-2026-001</p>
            </div>
            <button onclick="closeInvoice()" class="p-2 rounded-full text-charcoal hover:text-gold hover:bg-charcoal/5 transition-colors border border-charcoal/15">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <div class="p-6 space-y-7 flex-1">

            <!-- Branding + Dates -->
            <div class="flex justify-between items-start">
                <div>
                    <img src="images/logo-light.svg" alt="De'Osa" class="h-8 w-auto">
                </div>
                <div class="text-right font-sans text-xs text-charcoal">
                    <p id="inv-issued">Issued: 15 January 2026</p>
                    <p id="inv-due" class="mt-0.5">Due: 12 July 2026</p>
                </div>
            </div>

            <!-- Bill To -->
            <div class="p-5 rounded-lg" style="background:rgba(28,28,28,0.04);border:1px solid rgba(28,28,28,0.08);">
                <p class="font-sans text-[10px] uppercase tracking-widest text-gold mb-3">Bill To</p>
                <p id="inv-name" class="font-serif text-lg text-charcoal">Eleanor Vance</p>
                <p id="inv-email" class="font-sans text-xs text-charcoal mt-1">eleanor.v@email.com</p>
            </div>

            <!-- Event Details -->
            <div class="p-5 rounded-lg" style="background:rgba(28,28,28,0.04);border:1px solid rgba(28,28,28,0.08);">
                <p class="font-sans text-[10px] uppercase tracking-widest text-charcoal mb-3">Event Details</p>
                <p id="inv-event" class="font-serif text-lg text-charcoal">Wedding — 150 Guests — Plated Multi-Course</p>
                <p id="inv-venue" class="font-sans text-xs text-charcoal mt-1">Syon Park · 12 Aug 2026</p>
            </div>

            <!-- Line Items -->
            <div>
                <p class="font-sans text-[10px] uppercase tracking-widest text-charcoal mb-3">Order Summary</p>
                <div id="inv-items" class="divide-y divide-charcoal/10">
                    <div class="flex justify-between py-3 font-sans text-sm">
                        <div>
                            <p class="text-charcoal">Catering Service</p>
                            <p class="text-charcoal text-xs mt-0.5">150 guests × £90 per person</p>
                        </div>
                        <span class="text-charcoal font-medium">£13,500.00</span>
                    </div>
                    <div class="flex justify-between py-3 font-sans text-sm">
                        <div>
                            <p class="text-charcoal">Staffing &amp; Service</p>
                            <p class="text-charcoal text-xs mt-0.5">Event day staff &amp; coordination</p>
                        </div>
                        <span class="text-charcoal font-medium">£2,250.00</span>
                    </div>
                    <div class="flex justify-between py-3 font-sans text-sm">
                        <div>
                            <p class="text-charcoal">Tableware Rentals</p>
                            <p class="text-charcoal text-xs mt-0.5">Full place settings &amp; serveware</p>
                        </div>
                        <span class="text-charcoal font-medium">£1,100.00</span>
                    </div>
                </div>
            </div>

            <!-- Totals -->
            <div class="p-5 rounded-lg space-y-3" style="background:rgba(28,28,28,0.04);border:1px solid rgba(28,28,28,0.08);">
                <div class="flex justify-between font-sans text-sm text-charcoal">
                    <span>Subtotal</span>
                    <span id="inv-subtotal">£16,850.00</span>
                </div>
                <div class="flex justify-between font-sans text-sm text-green-600">
                    <span id="inv-deposit-label">Deposit Paid (25%)</span>
                    <span id="inv-deposit">– £4,212.50</span>
                </div>
                <div class="flex justify-between pt-3 border-t border-charcoal/10">
                    <span class="font-sans text-sm font-bold text-charcoal">Balance Due</span>
                    <span id="inv-balance" class="font-serif text-xl text-gold">£12,637.50</span>
                </div>
                <p id="inv-terms" class="font-sans text-[10px] text-charcoal">Due by 12 July 2026 · Bank transfer or card accepted</p>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 pb-6">
                <button class="flex-1 py-3 bg-charcoal/5 border border-charcoal/15 text-charcoal rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:border-charcoal/30 transition-all">Download PDF</button>
                <button class="flex-1 py-3 bg-gold/20 border border-gold/40 text-gold rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:bg-gold hover:text-charcoal transition-all">Email to Client</button>
            </div>
        </div>
    </div>

    <script>
        const crmData = [
            {
                id: 1,
                customer: { name: "Eleanor Vance", email: "eleanor.v@email.com", phone: "07912 345 678" },
                order: { details: "Wedding — 150 Guests — Plated Multi-Course", venue: "Syon Park", date: "12 Aug 2026" },
                call: { time: "12m 45s", outcome: "Booking Confirmed", hasRecording: true, callDate: "2026-02-24T14:22:00" },
                comms: { textSent: true, textTime: "2026-02-24T14:30:00" },
                billing: { invoiceStatus: "Paid", subtotal: "£16,850.00", depositLabel: "Deposit Paid (25%)", deposit: "– £4,212.50", balance: "£12,637.50", terms: "Due by 12 July 2026 · Bank transfer or card accepted" }
            },
            {
                id: 2,
                customer: { name: "Marcus Johnson", email: "mjohnson88@email.co.uk", phone: "07888 123 456" },
                order: { details: "Corporate Gala — 300 Guests — Buffet", venue: "Battersea Arts Centre", date: "05 Nov 2026" },
                call: { time: "08m 12s", outcome: "Quote Requested", hasRecording: true, callDate: "2026-02-23T09:08:00" },
                comms: { textSent: true, textTime: "2026-02-23T09:15:00" },
                billing: { invoiceStatus: "Sent", subtotal: "£28,500.00", depositLabel: "Deposit Paid (25%)", deposit: "– £7,125.00", balance: "£21,375.00", terms: "Due by 20 October 2026 · Bank transfer or card accepted" }
            },
            {
                id: 3,
                customer: { name: "Sarah & David", email: "sarah.david26@email.com", phone: "07771 987 654" },
                order: { details: "Wedding — 80 Guests — Family Style", venue: "Chelsea Harbour Hotel", date: "22 Sep 2026" },
                call: { time: "25m 00s", outcome: "Tasting Scheduled", hasRecording: true, callDate: "2026-02-20T11:35:00" },
                comms: { textSent: false, textTime: "" },
                billing: { invoiceStatus: "To Be Sent", subtotal: "£10,150.00", depositLabel: "Deposit Paid (25%)", deposit: "– £2,537.50", balance: "£7,612.50", terms: "Due by 22 August 2026 · Bank transfer or card accepted" }
            },
            {
                id: 4,
                customer: { name: "Amina Bello", email: "abello.events@email.com", phone: "07555 321 098" },
                order: { details: "Private Party — 30 Guests — Canapés & Drinks", venue: "Private Residence", date: "15 Jul 2026" },
                call: { time: "04m 30s", outcome: "Information Sent", hasRecording: true, callDate: "2026-02-24T10:00:00" },
                comms: { textSent: true, textTime: "2026-02-24T10:00:00" },
                billing: { invoiceStatus: "To Be Sent", subtotal: "£3,400.00", depositLabel: "Deposit Paid (25%)", deposit: "– £850.00", balance: "£2,550.00", terms: "Due by 1 July 2026 · Bank transfer or card accepted" }
            },
            {
                id: 5,
                customer: { name: "Jonathan Wright", email: "j.wright@email.co.uk", phone: "07444 888 999" },
                order: { details: "Wedding — 200 Guests — Plated Multi-Course", venue: "The Willows", date: "10 Oct 2026" },
                call: { time: "18m 20s", outcome: "Booking Confirmed", hasRecording: true, callDate: "2026-01-30T16:45:00" },
                comms: { textSent: true, textTime: "2026-01-30T16:45:00" },
                billing: { invoiceStatus: "Paid", subtotal: "£24,700.00", depositLabel: "Deposit Paid (25%)", deposit: "– £6,175.00", balance: "£18,525.00", terms: "Due by 10 September 2026 · Bank transfer or card accepted" }
            }
        ];

        /* ── Timestamp helpers ──────────────────────────────────────────────
         * callDate in crmData is stored as ISO 8601 ("2026-02-24T14:22:00").
         * These helpers format it for display and compute the filter period.
         */
        function _fmtDate(isoStr) {
            if (!isoStr) return 'Unknown';
            try {
                const d    = new Date(isoStr);
                const now  = new Date();
                const msAgo = now - d;
                const daysAgo = msAgo / 86400000;
                const timeStr = d.toLocaleString('en-GB', { timeZone: 'Europe/London', hour: '2-digit', minute: '2-digit' });
                if (daysAgo < 1)  return 'Today, '     + timeStr;
                if (daysAgo < 2)  return 'Yesterday, ' + timeStr;
                return d.toLocaleString('en-GB', { timeZone: 'Europe/London', day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            } catch (_) { return isoStr; }
        }

        function _datePeriod(isoStr) {
            if (!isoStr) return 'month';
            try {
                const daysAgo = (new Date() - new Date(isoStr)) / 86400000;
                if (daysAgo < 1) return 'today';
                if (daysAgo < 7) return 'week';
                return 'month';
            } catch (_) { return 'month'; }
        }

        /* Returns { callDate, callDuration } — real EL values when a recording
         * is matched by call_summary_title, otherwise formatted crmData values. */
        function _realTimestamps(row) {
            const nameParts = row.customer.name.toLowerCase().split(/\s+/).filter(p => p.length > 2 && p !== '&');
            const elCall = (window._elCalls || []).find(c => {
                const title = (c.call_summary_title || '').toLowerCase();
                return nameParts.some(p => title.includes(p));
            });
            let callDate     = _fmtDate(row.call.callDate);
            let callDuration = row.call.time;
            if (elCall) {
                if (elCall.start_time_unix_secs) {
                    const d = new Date(elCall.start_time_unix_secs * 1000);
                    callDate = d.toLocaleString('en-GB', {
                        timeZone: 'Europe/London', day: '2-digit', month: 'short',
                        year: 'numeric', hour: '2-digit', minute: '2-digit'
                    });
                }
                if (elCall.call_duration_secs != null) {
                    const m = Math.floor(elCall.call_duration_secs / 60);
                    const s = elCall.call_duration_secs % 60;
                    callDuration = m + 'm ' + String(s).padStart(2, '0') + 's';
                }
            }
            return { callDate, callDuration };
        }

        const tableBody         = document.getElementById('crm-table-body');
        const searchInput       = document.getElementById('global-search');
        const filterDate        = document.getElementById('filter-date');
        const filterOutcome     = document.getElementById('filter-outcome');
        const filterInvoice     = document.getElementById('filter-invoice');
        const sortCalls         = document.getElementById('sort-calls');
        const noDataMsg         = document.getElementById('no-data-msg');

        // Computed dynamically from ISO callDate — no longer a hardcoded map
        const rowDatePeriod = {};
        crmData.forEach(r => { rowDatePeriod[r.id] = _datePeriod(r.call.callDate); });
        const visibleCount      = document.getElementById('visible-count');
        const transcriptOverlay = document.getElementById('transcript-overlay');
        const transcriptDrawer  = document.getElementById('transcript-drawer');
        const drawerClientName  = document.getElementById('drawer-client-name');

        /* ── Metric period filter ── */
        const metricData = {
            today: { calls: 18,  callsSub: 'Today',      confirmed: 3,  invoices: 7,   pending: '£2,100'  },
            week:  { calls: 124, callsSub: 'This week',  confirmed: 28, invoices: 45,  pending: '£12,450' },
            month: { calls: 486, callsSub: 'This month', confirmed: 92, invoices: 163, pending: '£48,200' }
        };

        function setMetricPeriod(period) {
            const d = metricData[period];
            document.getElementById('metric-calls').textContent     = d.calls;
            document.getElementById('metric-calls-sub').textContent = d.callsSub;
            document.getElementById('metric-confirmed').textContent = d.confirmed;
            document.getElementById('metric-invoices').textContent  = d.invoices;
            document.getElementById('metric-pending').textContent   = d.pending;

            document.querySelectorAll('.metric-period').forEach(btn => {
                const active = btn.dataset.period === period;
                btn.style.color        = active ? '#C5A059' : 'rgba(253,251,247,0.35)';
                btn.style.borderColor  = active ? 'rgba(197,160,89,0.5)' : 'rgba(253,251,247,0.1)';
                btn.style.background   = active ? 'rgba(197,160,89,0.1)' : 'transparent';
            });
        }

        document.getElementById('metric-period-bar').addEventListener('click', e => {
            const btn = e.target.closest('.metric-period');
            if (btn) setMetricPeriod(btn.dataset.period);
        });

        // Initialise on today
        document.addEventListener('DOMContentLoaded', () => setMetricPeriod('today'));

        function parseDuration(timeStr) {
            const m = timeStr.match(/(\d+)m\s*(\d+)s/);
            return m ? parseInt(m[1]) * 60 + parseInt(m[2]) : 0;
        }

        function getInitials(name) {
            return name.split(' ').map(w => w[0]).join('').slice(0, 2).toUpperCase();
        }

        function renderTable(data) {
            tableBody.innerHTML = '';

            if (data.length === 0) {
                noDataMsg.classList.remove('hidden');
                noDataMsg.classList.add('flex');
                visibleCount.innerText = '0';
                return;
            }

            noDataMsg.classList.add('hidden');
            noDataMsg.classList.remove('flex');
            visibleCount.innerText = data.length;

            data.forEach(row => {
                let invoiceBadge = '';
                if (row.billing.invoiceStatus === 'Paid')      invoiceBadge = '<span class="badge badge-paid">Paid</span>';
                else if (row.billing.invoiceStatus === 'Sent') invoiceBadge = '<span class="badge badge-sent">Sent</span>';
                else                                            invoiceBadge = '<span class="badge badge-pending">Pending</span>';

                let outcomeColor = 'text-cream/40 font-light';
                if (row.call.outcome.includes('Confirmed'))                                                  outcomeColor = 'text-green-400 font-medium';
                else if (row.call.outcome.includes('Requested') || row.call.outcome.includes('Scheduled')) outcomeColor = 'text-gold font-medium';

                const safeName = row.customer.name.replace(/'/g, "\\'");

                const tr = document.createElement('tr');
                tr.className = 'hover:bg-cream/[0.03] transition-colors cursor-pointer';
                tr.addEventListener('click', e => {
                    if (e.target.closest('button')) return;
                    localStorage.setItem('crm_client', JSON.stringify(row));
                    window.location.href = 'client-profile.html';
                });
                tr.innerHTML = `
                    <td class="p-4 align-top">
                        <p class="font-serif text-lg text-cream">${row.customer.name}</p>
                        <div class="flex items-center gap-2 mt-1 text-cream/40 text-xs font-light">
                            <svg class="w-3 h-3 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                            ${row.customer.email}
                        </div>
                    </td>
                    <td class="p-4 align-top">
                        <p class="font-light text-cream/80 text-sm leading-snug max-w-xs">${row.order.details}</p>
                        <p class="text-xs text-cream/35 mt-1 font-light"><span class="text-gold/70 border-b border-gold/20 pb-[1px]">${row.order.venue}</span> · ${row.order.date}</p>
                    </td>
                    <td class="p-4 align-top">
                        <p class="text-sm ${outcomeColor}">${row.call.outcome}</p>
                        <p class="text-xs text-cream/35 mt-1 font-light">${_fmtDate(row.call.callDate)}</p>
                        <p class="text-xs text-cream/25 mt-0.5 font-light">Duration: ${row.call.time}</p>
                        <button onclick="_openMediaForRow(${row.id})" class="mt-2 text-xs uppercase tracking-widest font-medium text-gold/70 hover:text-gold flex items-center gap-1.5 transition-colors border border-gold/20 hover:border-gold/50 px-2.5 py-1.5 rounded-md">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                            Open Media
                        </button>
                    </td>
                    <td class="p-4 align-top">
                        <div class="flex items-center gap-2 text-sm font-light">
                            ${row.comms.textSent
                                ? `<svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> <span class="text-cream/50 text-xs">Text Sent</span>`
                                : `<span class="badge badge-neutral">No Text</span>`
                            }
                        </div>
                        ${row.comms.textTime ? `<p class="text-xs text-cream/35 font-light mt-1">${row.comms.textTime}</p>` : ''}
                        <div class="flex gap-2 mt-2 flex-wrap">
                            ${row.comms.textSent ? `<button onclick="openCommsSheet('text','${safeName}','${row.comms.textTime}')" class="text-[10px] uppercase tracking-widest font-medium text-cream/40 hover:text-gold flex items-center gap-1 transition-colors border border-cream/10 hover:border-gold/40 px-2 py-1 rounded-md">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                                View Text</button>` : ''}
                            <button onclick="openCommsSheet('email','${safeName}','${row.comms.textTime}')" class="text-[10px] uppercase tracking-widest font-medium text-cream/40 hover:text-gold flex items-center gap-1 transition-colors border border-cream/10 hover:border-gold/40 px-2 py-1 rounded-md">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                View Email</button>
                        </div>
                    </td>
                    <td class="p-4 align-top text-right">
                        <div class="flex flex-col items-end gap-2">
                            ${invoiceBadge}
                            <button onclick="openInvoice(${JSON.stringify(row).replace(/"/g, '&quot;')})" class="text-[10px] uppercase tracking-widest font-medium text-cream/40 hover:text-gold flex items-center gap-1.5 transition-colors border border-cream/10 hover:border-gold/40 px-2.5 py-1.5 rounded-md">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                Invoice
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        function applyFilters() {
            const query   = searchInput.value.toLowerCase();
            const outcome = filterOutcome.value;
            const invoice = filterInvoice.value;

            const sort    = sortCalls.value;
            const datePeriod = filterDate.value;

            // Period inclusion: today ⊂ week ⊂ month
            const periodRank = { today: 1, week: 2, month: 3 };

            let filtered = crmData.filter(row => {
                const matchesSearch =
                    row.customer.name.toLowerCase().includes(query) ||
                    row.customer.email.toLowerCase().includes(query) ||
                    row.customer.phone.includes(query) ||
                    row.order.details.toLowerCase().includes(query) ||
                    row.order.venue.toLowerCase().includes(query);
                const matchesOutcome = outcome === 'all' || row.call.outcome === outcome;
                const matchesInvoice = invoice === 'all' || row.billing.invoiceStatus === invoice;
                const matchesDate    = datePeriod === 'all' ||
                    (periodRank[rowDatePeriod[row.id]] || 0) <= (periodRank[datePeriod] || 99);
                return matchesSearch && matchesOutcome && matchesInvoice && matchesDate;
            });

            if (sort === 'recent')   filtered = [...filtered].sort((a, b) => b.id - a.id);
            if (sort === 'longest')  filtered = [...filtered].sort((a, b) => parseDuration(b.call.time) - parseDuration(a.call.time));
            if (sort === 'shortest') filtered = [...filtered].sort((a, b) => parseDuration(a.call.time) - parseDuration(b.call.time));

            renderTable(filtered);
        }

        /* ── ElevenLabs API constants ── */
        const EL_API_KEY  = 'sk_4b4ff3b79f758ba057818d597d4aebbf980e9bc77ddd1102';
        const EL_AGENT_ID = 'agent_2901kj45e7cnfszrrjfhfj4qdc8j';
        const EL_BASE     = 'https://api.elevenlabs.io/v1/convai/conversations';

        window._elCalls = [];

        async function loadCallRecordings() {
            try {
                const res = await fetch(`${EL_BASE}?agent_id=${EL_AGENT_ID}&page_size=50`, {
                    headers: { 'xi-api-key': EL_API_KEY }
                });
                if (!res.ok) return;
                const data = await res.json();
                window._elCalls = data.conversations || [];
            } catch (e) {
                console.warn('[De\'Osa] EL call recordings load failed:', e);
            }
        }

        function _fmtTime(s) {
            if (!isFinite(s) || s < 0) return '0:00';
            const m = Math.floor(s / 60);
            const sec = String(Math.floor(s % 60)).padStart(2, '0');
            return `${m}:${sec}`;
        }

        async function showDrawerRecording(convId) {
            try {
                const res = await fetch(`${EL_BASE}/${convId}/audio`, {
                    headers: { 'xi-api-key': EL_API_KEY }
                });
                if (!res.ok) return;
                const blob = await res.blob();
                const url  = URL.createObjectURL(blob);
                const audio = document.getElementById('drawer-audio-el');
                audio.src = url;
                audio.onloadedmetadata = () => {
                    document.getElementById('drawer-total').textContent = _fmtTime(audio.duration);
                };
                audio.ontimeupdate = () => {
                    const pct = audio.duration ? (audio.currentTime / audio.duration) * 100 : 0;
                    document.getElementById('drawer-progress-fill').style.width = pct + '%';
                    document.getElementById('drawer-elapsed').textContent = _fmtTime(audio.currentTime);
                };
                audio.onended = () => {
                    document.getElementById('drawer-play-icon').classList.remove('hidden');
                    document.getElementById('drawer-pause-icon').classList.add('hidden');
                };
                document.getElementById('drawer-recording-section').classList.remove('hidden');
            } catch (e) {
                console.warn('[De\'Osa] Could not load recording:', e);
            }
        }

        async function showDrawerTranscript(convId) {
            try {
                const res  = await fetch(`${EL_BASE}/${convId}`, {
                    headers: { 'xi-api-key': EL_API_KEY }
                });
                if (!res.ok) return;
                const data = await res.json();
                const msgs = data.transcript || [];
                const container = document.getElementById('drawer-transcript-messages');
                container.innerHTML = msgs.map(m => {
                    const isAgent = m.role === 'agent';
                    const safe = (m.message || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    return `<div class="flex ${isAgent ? 'justify-start' : 'justify-end'}">
                        <div class="max-w-[85%] px-4 py-2.5 rounded-2xl font-sans text-xs leading-relaxed ${
                            isAgent
                                ? 'rounded-tl-sm bg-cream/8 border border-cream/10 text-cream/70'
                                : 'rounded-tr-sm bg-gold/15 border border-gold/25 text-cream/85'
                        }">${safe}</div>
                    </div>`;
                }).join('');
                document.getElementById('drawer-transcript-section').classList.remove('hidden');
            } catch (e) {
                console.warn('[De\'Osa] Could not load transcript:', e);
            }
        }

        window.toggleDrawerAudio = function() {
            const audio = document.getElementById('drawer-audio-el');
            if (audio.paused) {
                audio.play();
                document.getElementById('drawer-play-icon').classList.add('hidden');
                document.getElementById('drawer-pause-icon').classList.remove('hidden');
            } else {
                audio.pause();
                document.getElementById('drawer-play-icon').classList.remove('hidden');
                document.getElementById('drawer-pause-icon').classList.add('hidden');
            }
        };

        window.seekDrawerAudio = function(e) {
            const audio = document.getElementById('drawer-audio-el');
            if (!audio.duration) return;
            const bar  = document.getElementById('drawer-progress-bar');
            const rect = bar.getBoundingClientRect();
            const pct  = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            audio.currentTime = pct * audio.duration;
        };

        /* Helper used by the table "Open Media" button */
        window._openMediaForRow = function(rowId) {
            const row = crmData.find(r => r.id === rowId);
            if (!row) return;
            const nameParts = row.customer.name.toLowerCase().split(/\s+/).filter(p => p.length > 2 && p !== '&');
            const elCall = (window._elCalls || []).find(c => {
                const title = (c.call_summary_title || '').toLowerCase();
                return nameParts.some(p => title.includes(p));
            });
            const convId = elCall ? elCall.conversation_id : null;
            const { callDate, callDuration } = _realTimestamps(row);
            openTranscript(row.customer.name, convId, row.customer.email, row.customer.phone, callDate, callDuration, row.call.outcome);
        };

        window.openTranscript = function(clientName, convId, email, phone, callDate, callDuration, callOutcome) {
            drawerClientName.innerText = clientName;
            document.querySelector('#transcript-drawer h3').textContent = 'Interaction Details';
            document.getElementById('drawer-contact-name').textContent = clientName   || '—';
            document.getElementById('drawer-email').textContent        = email        || '—';
            document.getElementById('drawer-phone').textContent        = phone        || '—';
            document.getElementById('drawer-call-date').textContent     = callDate     || '—';
            document.getElementById('drawer-call-duration').textContent = callDuration || '—';
            document.getElementById('drawer-call-outcome').textContent  = callOutcome  || '—';

            /* Reset recording + transcript sections */
            document.getElementById('drawer-recording-section').classList.add('hidden');
            document.getElementById('drawer-transcript-section').classList.add('hidden');
            const audio = document.getElementById('drawer-audio-el');
            audio.pause();
            audio.src = '';
            document.getElementById('drawer-progress-fill').style.width = '0%';
            document.getElementById('drawer-elapsed').textContent = '0:00';
            document.getElementById('drawer-total').textContent = '—';
            document.getElementById('drawer-play-icon').classList.remove('hidden');
            document.getElementById('drawer-pause-icon').classList.add('hidden');
            document.getElementById('drawer-transcript-messages').innerHTML = '';

            if (convId) {
                showDrawerRecording(convId);
                showDrawerTranscript(convId);
            }

            transcriptOverlay.classList.remove('hidden');
            setTimeout(() => {
                transcriptOverlay.classList.remove('opacity-0');
                transcriptDrawer.classList.remove('drawer-closed');
                transcriptDrawer.classList.add('drawer-open');
            }, 10);
        };

        window.closeTranscript = function() {
            transcriptDrawer.classList.remove('drawer-open');
            transcriptDrawer.classList.add('drawer-closed');
            transcriptOverlay.classList.add('opacity-0');
            setTimeout(() => transcriptOverlay.classList.add('hidden'), 300);
        };

        searchInput.addEventListener('input', applyFilters);
        filterDate.addEventListener('change', applyFilters);
        filterOutcome.addEventListener('change', applyFilters);
        filterInvoice.addEventListener('change', applyFilters);
        sortCalls.addEventListener('change', applyFilters);

        document.addEventListener('DOMContentLoaded', () => {
            renderTable(crmData);
            loadCallRecordings();
        });

        /* Invoice drawer */
        const invoiceOverlay = document.getElementById('invoice-overlay');
        const invoiceDrawer  = document.getElementById('invoice-drawer');

        window.openInvoice = function(row) {
            document.getElementById('inv-name').innerText         = row.customer.name;
            document.getElementById('inv-email').innerText        = row.customer.email;
            document.getElementById('inv-phone').innerText        = row.customer.phone;
            document.getElementById('inv-event').innerText        = row.order.details;
            document.getElementById('inv-venue').innerText        = row.order.venue + ' · ' + row.order.date;
            document.getElementById('invoice-ref').innerText      = '#DOC-2026-00' + row.id;
            document.getElementById('inv-subtotal').innerText     = row.billing.subtotal     || '—';
            document.getElementById('inv-deposit-label').innerText= row.billing.depositLabel || 'Deposit Paid';
            document.getElementById('inv-deposit').innerText      = row.billing.deposit      || '—';
            document.getElementById('inv-balance').innerText      = row.billing.balance      || '—';
            document.getElementById('inv-terms').innerText        = row.billing.terms        || '';
            invoiceOverlay.classList.remove('hidden');
            setTimeout(() => {
                invoiceOverlay.classList.remove('opacity-0');
                invoiceDrawer.classList.remove('drawer-closed');
                invoiceDrawer.classList.add('drawer-open');
            }, 10);
        };

        window.closeInvoice = function() {
            invoiceDrawer.classList.remove('drawer-open');
            invoiceDrawer.classList.add('drawer-closed');
            invoiceOverlay.classList.add('opacity-0');
            setTimeout(() => invoiceOverlay.classList.add('hidden'), 300);
        };

        /* Comms bottom sheet */
        // Elements are defined after this script block, so resolve lazily on first use
        let commsOverlay, commsSheet;
        function getCommsEls() {
            if (!commsOverlay) commsOverlay = document.getElementById('comms-overlay');
            if (!commsSheet)   commsSheet   = document.getElementById('comms-sheet');
        }

        const commsContent = {
            text: {
                title: 'Text Message',
                body: (name, sentTime) => `
                    <div class="space-y-4">
                        <div class="flex items-center justify-between pb-4" style="border-bottom:1px solid rgba(253,251,247,0.08);">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-gold/20 border border-gold/30 flex items-center justify-center text-gold font-serif text-xs shrink-0">AI</div>
                                <div>
                                    <p class="font-sans text-xs font-bold text-cream">De'Osa Catering</p>
                                    <p class="font-sans text-[10px]" style="color:rgba(253,251,247,0.35);">Automated · SMS</p>
                                </div>
                            </div>
                            ${sentTime ? `<div class="text-right">
                                <p class="font-sans text-[10px] uppercase tracking-widest" style="color:rgba(253,251,247,0.3);">Sent</p>
                                <p class="font-sans text-xs font-medium text-gold/80">${sentTime}</p>
                            </div>` : ''}
                        </div>
                        <div class="bg-cream/5 border border-cream/8 rounded-xl rounded-tl-none p-4 max-w-sm">
                            <p class="font-sans text-sm text-cream/80 leading-relaxed">Hi ${name}, thank you for your enquiry with De'Osa Luxury Catering. We've received your details and a bespoke menu proposal has been sent to your email. Our team will be in touch shortly to discuss your event. — De'Osa Team</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <p class="font-sans text-[10px] uppercase tracking-widest" style="color:rgba(253,251,247,0.25);">Delivered · Read</p>
                            ${sentTime ? `<p class="font-sans text-[10px]" style="color:rgba(253,251,247,0.25);">${sentTime}</p>` : ''}
                        </div>
                    </div>`
            },
            email: {
                title: 'Email',
                body: (name, sentTime) => `
                    <div class="space-y-5">
                        <div class="space-y-1 pb-4" style="border-bottom:1px solid rgba(253,251,247,0.08);">
                            <div class="flex justify-between items-start">
                                <div class="space-y-1">
                                    <p class="font-sans text-xs font-bold text-gold uppercase tracking-widest">From</p>
                                    <p class="font-sans text-xs text-cream/70">enquiries@deosa.co.uk</p>
                                    <p class="font-sans text-xs font-bold text-gold uppercase tracking-widest mt-2">To</p>
                                    <p class="font-sans text-xs text-cream/70">${name}</p>
                                </div>
                                ${sentTime ? `<div class="text-right shrink-0 ml-4">
                                    <p class="font-sans text-[10px] uppercase tracking-widest" style="color:rgba(253,251,247,0.3);">Sent</p>
                                    <p class="font-sans text-xs font-medium text-gold/80">${sentTime}</p>
                                </div>` : ''}
                            </div>
                            <p class="font-sans text-xs font-bold text-gold uppercase tracking-widest mt-2">Subject</p>
                            <p class="font-serif text-base text-cream">Your Bespoke Menu Proposal — De'Osa Luxury Catering</p>
                        </div>
                        <div class="font-sans text-sm text-cream/75 leading-relaxed space-y-3">
                            <p>Dear ${name},</p>
                            <p>Thank you for reaching out to De'Osa Luxury Catering. It was a pleasure speaking with you about your upcoming event.</p>
                            <p>Please find attached your personalised menu proposal, curated to reflect the details discussed during our call. The proposal includes a full breakdown of our suggested menu courses, staffing arrangements, and estimated investment.</p>
                            <p>Should you wish to proceed or have any amendments, please don't hesitate to reply to this email or call us directly.</p>
                            <p>We look forward to making your event truly unforgettable.</p>
                            <p class="pt-2">Warm regards,<br><span class="font-bold text-cream">The De'Osa Team</span></p>
                        </div>
                        <div class="flex items-center gap-2 pt-2" style="border-top:1px solid rgba(253,251,247,0.08);">
                            <svg class="w-4 h-4 text-gold/60 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg>
                            <span class="font-sans text-xs text-cream/40">menu_proposal_deosa.pdf</span>
                        </div>
                    </div>`
            }
        };

        window.openCommsSheet = function(type, clientName, sentTime) {
            getCommsEls();
            const cfg = commsContent[type];
            document.getElementById('comms-sheet-title').textContent = cfg.title;
            document.getElementById('comms-sheet-sub').textContent   = `Sent to ${clientName}${sentTime ? ' · ' + sentTime : ''}`;
            document.getElementById('comms-sheet-body').innerHTML    = cfg.body(clientName, sentTime);
            commsOverlay.classList.remove('hidden');
            requestAnimationFrame(() => {
                commsOverlay.classList.remove('opacity-0');
                commsSheet.style.transform = 'translateY(0%)';
            });
        };

        window.closeCommsSheet = function() {
            getCommsEls();
            commsSheet.style.transform = 'translateY(100%)';
            commsOverlay.classList.add('opacity-0');
            setTimeout(() => commsOverlay.classList.add('hidden'), 380);
        };

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const isOpen = !menu.classList.contains('opacity-0');
            menu.classList.toggle('opacity-0', isOpen);
            menu.classList.toggle('pointer-events-none', isOpen);
        }

        /* ═══════════════════════════════════════════════════════════
           CALL LOG
        ═══════════════════════════════════════════════════════════ */

        const DEFAULT_CALL_LOG = [
            {
                id: 1740476040000, name: 'Priya Nair', phone: '07923 456 789', email: 'p.nair@email.com',
                source: 'Instagram', time: '2026-02-25T10:14:00', eventType: 'Wedding', eventDate: '2026-09-20',
                eventStart: '12:00', eventEnd: '23:00', guests: '130', venue: 'Morden Hall Park',
                venueConfirmed: 'Yes – confirmed', indoorOutdoor: 'Indoor', kitchen: 'Full commercial kitchen',
                serviceStyle: 'Silver Plated', courses: '3 courses', canapes: 'Yes', bar: 'Full bar', cake: 'Yes',
                cuisine: 'Mediterranean', starter: 'Burrata with heirloom tomatoes',
                main: 'Herb-crusted lamb with dauphinoise', dessert: 'Elderflower panna cotta',
                dietary: 'Vegetarian options for 12, halal for all meat dishes',
                arrival: '08:00', access: 'Easy – loading bay available', parking: 'Yes',
                hire: 'Linens, Crockery, Glassware', logisticsNotes: '',
                budgetPP: '£90-110pp', budgetTotal: '~£13,000', quoted: 'No', tasting: 'Yes',
                timeline: 'Within 1-2 weeks', followUp: 'Email', comparing: 'Yes',
                summary: 'Caller enquired about wedding catering for 130 guests at Morden Hall Park in September 2026. 3-course silver plated service, Mediterranean theme. Budget £90-110pp. Vegetarian & halal options needed. Comparing two other caterers. Requested proposal by email and interested in a tasting.',
                outcome: 'Quote Requested'
            },
            {
                id: 1740462120000, name: '', phone: '', email: '', source: 'Website',
                time: '2026-02-25T06:22:00', eventType: 'Corporate Gala', eventDate: '',
                eventStart: '18:30', eventEnd: '23:00', guests: '200', venue: 'TBC – Central London',
                venueConfirmed: 'Still looking', indoorOutdoor: 'Indoor', kitchen: 'Unknown',
                serviceStyle: 'Buffet', courses: '1 course', canapes: 'Yes', bar: 'Full bar', cake: 'N/A',
                cuisine: '', starter: '', main: '', dessert: '', dietary: 'Mix of needs – full list TBC',
                arrival: '', access: 'Unknown', parking: 'Unknown', hire: 'None', logisticsNotes: '',
                budgetPP: '£60-70pp', budgetTotal: '~£13,000', quoted: 'No', tasting: 'Maybe',
                timeline: 'Unknown', followUp: 'Phone', comparing: 'Unknown',
                summary: 'Anonymous caller enquiring about a corporate gala for approx 200 guests. Venue TBC, Central London. Buffet style with canapés and full bar. Budget around £60-70pp. Will call back once a date is confirmed.',
                outcome: 'Callback Required'
            },
            {
                id: 1740409980000, name: 'Thomas Osei', phone: '07800 123 456', email: 'thomas.o@creativeco.com',
                source: 'Referral', time: '2026-02-24T15:33:00', eventType: 'Birthday', eventDate: '2026-07-05',
                eventStart: '18:00', eventEnd: '23:00', guests: '60', venue: 'Private Residence – Kensington',
                venueConfirmed: 'Yes – confirmed', indoorOutdoor: 'Indoor', kitchen: 'Basic facilities',
                serviceStyle: 'Canapés & Drinks Reception', courses: '1 course', canapes: 'Yes',
                bar: 'Wine & beer only', cake: 'N/A', cuisine: '', starter: '', main: '', dessert: '',
                dietary: 'Nut allergy – 1 guest, gluten-free – 3 guests',
                arrival: '15:00', access: 'Limited access', parking: 'No', hire: 'Glassware',
                logisticsNotes: 'Tight staircase, no loading bay',
                budgetPP: '£75pp', budgetTotal: '~£4,500', quoted: 'No', tasting: 'No',
                timeline: 'ASAP', followUp: 'WhatsApp', comparing: 'No',
                summary: 'Referred by Sarah & David. Birthday canapés & drinks reception for 60 guests in Kensington. Budget £75pp. Nut allergy and gluten-free needs noted. Tight staircase access. Information pack sent via WhatsApp.',
                outcome: 'Information Sent'
            },
            {
                id: 1740391500000, name: '', phone: '07700 900 123', email: '', source: 'Google',
                time: '2026-02-24T10:25:00', eventType: 'Anniversary', eventDate: '2026-06-14',
                eventStart: '19:00', eventEnd: '00:00', guests: '40', venue: 'The Connaught – Mayfair',
                venueConfirmed: 'Yes – confirmed', indoorOutdoor: 'Indoor', kitchen: 'Full commercial kitchen',
                serviceStyle: 'Silver Plated', courses: '4+ courses', canapes: 'Yes', bar: 'Full bar', cake: 'N/A',
                cuisine: 'French-British', starter: '', main: '', dessert: '', dietary: '1 vegan, 1 nut allergy',
                arrival: '12:00', access: 'Easy – loading bay available', parking: 'Yes', hire: 'None', logisticsNotes: '',
                budgetPP: '£120+pp', budgetTotal: 'Open', quoted: 'No', tasting: 'Yes',
                timeline: 'Within 1-2 weeks', followUp: 'Email', comparing: 'No',
                summary: 'Intimate anniversary dinner for 40 at The Connaught. 4-course silver plated with reception canapés. Premium open budget. French-British cuisine preferred. Dietary: 1 vegan, 1 nut allergy. Tasting session booked for early March.',
                outcome: 'Tasting Scheduled'
            },
            {
                id: 1740321600000, name: 'Fatima Al-Rashid', phone: '07600 987 654', email: 'fatima.ar@outlook.com',
                source: 'Word of Mouth', time: '2026-02-23T14:40:00', eventType: 'Christening', eventDate: '2026-05-10',
                eventStart: '13:00', eventEnd: '18:00', guests: '90', venue: 'St. James Church Hall – Islington',
                venueConfirmed: 'Yes – confirmed', indoorOutdoor: 'Indoor', kitchen: 'Basic facilities',
                serviceStyle: 'Buffet', courses: '1 course', canapes: 'No', bar: 'Soft drinks only', cake: 'N/A',
                cuisine: '', starter: '', main: '', dessert: '', dietary: 'Halal-only menu required throughout',
                arrival: '10:00', access: 'Limited access', parking: 'Unknown', hire: 'None', logisticsNotes: '',
                budgetPP: '£45-55pp', budgetTotal: '~£4,500', quoted: 'No', tasting: 'No',
                timeline: 'Within 1 month', followUp: 'Phone', comparing: 'Unknown',
                summary: 'Christening catering for 90 guests at a church hall in Islington. Halal-only buffet, soft drinks only. Budget £45-55pp. Quote requested, decision expected within a month.',
                outcome: 'Quote Requested'
            }
        ];

        function loadCallLog() {
            try {
                const s = localStorage.getItem('deosa_call_log');
                return s ? JSON.parse(s) : DEFAULT_CALL_LOG;
            } catch (_) { return DEFAULT_CALL_LOG; }
        }

        function persistCallLog(log) {
            localStorage.setItem('deosa_call_log', JSON.stringify(log));
        }

        function _clFmtTime(isoStr) {
            if (!isoStr) return '—';
            try {
                const d = new Date(isoStr);
                const daysAgo = (Date.now() - d) / 86400000;
                const t = d.toLocaleString('en-GB', { timeZone: 'Europe/London', hour: '2-digit', minute: '2-digit' });
                if (daysAgo < 1)  return 'Today, ' + t;
                if (daysAgo < 2)  return 'Yesterday, ' + t;
                return d.toLocaleString('en-GB', { timeZone: 'Europe/London', day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' });
            } catch (_) { return isoStr; }
        }

        const CL_OUTCOME_STYLE = {
            'Booking Confirmed': 'text-green-400 border-green-400/30',
            'Quote Requested':   'text-gold border-gold/30',
            'Tasting Scheduled': 'text-gold border-gold/30',
            'Information Sent':  'text-blue-300 border-blue-300/30',
            'Callback Required': 'text-orange-300 border-orange-300/30',
            'No Interest':       'text-cream/30 border-cream/15'
        };

        function _clDetailRow(label, val) {
            if (!val) return '';
            return `<div><p class="font-sans text-[10px] uppercase tracking-widest text-cream/30 mb-0.5">${label}</p><p class="font-sans text-xs text-cream/70">${val}</p></div>`;
        }

        function renderCallLog() {
            const log = loadCallLog();
            const container = document.getElementById('call-log-list');
            if (!container) return;

            if (log.length === 0) {
                container.innerHTML = `<div class="dash-card p-8 text-center"><svg class="w-8 h-8 text-cream/15 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg><p class="font-sans text-sm text-cream/30">No calls logged yet. Press <span class="text-gold">New Call</span> to begin.</p></div>`;
                return;
            }

            const sorted = [...log].sort((a, b) => b.id - a.id);
            container.innerHTML = sorted.map(e => {
                const isAnon = !e.name || !e.name.trim();
                const displayName = isAnon ? 'Anonymous' : e.name;
                const os = CL_OUTCOME_STYLE[e.outcome] || 'text-cream/40 border-cream/15';
                const meta = [_clFmtTime(e.time), e.eventType, e.guests ? e.guests + ' guests' : ''].filter(Boolean).join(' · ');
                return `
                <div class="dash-card px-5 py-4 hover:border-gold/20 transition-all">
                    <div class="flex items-start gap-4 cursor-pointer" onclick="toggleCallDetail(${e.id})">
                        <div class="w-9 h-9 rounded-full bg-gold/10 border border-gold/20 flex items-center justify-center text-gold shrink-0 mt-0.5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-wrap items-center justify-between gap-2">
                                <p class="font-serif text-lg ${isAnon ? 'text-cream/40 italic' : 'text-cream'}">${displayName}</p>
                                <span class="font-sans text-[10px] ${os} border rounded-full px-2.5 py-0.5 uppercase tracking-widest whitespace-nowrap">${e.outcome}</span>
                            </div>
                            <p class="font-sans text-[10px] text-cream/30 mt-0.5 tracking-wide">${meta}</p>
                            <p class="font-sans text-xs text-cream/50 mt-1.5 leading-relaxed" style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${e.summary || '—'}</p>
                        </div>
                    </div>
                    <div id="cl-detail-${e.id}" class="hidden mt-4 pt-4" style="border-top:1px solid rgba(253,251,247,0.07);">
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-3 mb-4">
                            ${_clDetailRow('Phone', e.phone)}
                            ${_clDetailRow('Email', e.email)}
                            ${_clDetailRow('Source', e.source)}
                            ${_clDetailRow('Event Date', e.eventDate)}
                            ${_clDetailRow('Time', e.eventStart && e.eventEnd ? e.eventStart + ' – ' + e.eventEnd : (e.eventStart || ''))}
                            ${_clDetailRow('Venue', e.venue)}
                            ${_clDetailRow('Venue Confirmed', e.venueConfirmed)}
                            ${_clDetailRow('Setting', e.indoorOutdoor)}
                            ${_clDetailRow('Kitchen', e.kitchen)}
                            ${_clDetailRow('Service Style', e.serviceStyle)}
                            ${_clDetailRow('Courses', e.courses)}
                            ${_clDetailRow('Canapés', e.canapes)}
                            ${_clDetailRow('Bar', e.bar)}
                            ${_clDetailRow('Cake Cutting', e.cake)}
                            ${_clDetailRow('Cuisine / Theme', e.cuisine)}
                            ${_clDetailRow('Starter', e.starter)}
                            ${_clDetailRow('Main', e.main)}
                            ${_clDetailRow('Dessert', e.dessert)}
                            ${e.dietary ? `<div class="col-span-2">${_clDetailRow('Dietary & Allergies', e.dietary)}</div>` : ''}
                            ${_clDetailRow('Team Arrival', e.arrival)}
                            ${_clDetailRow('Site Access', e.access)}
                            ${_clDetailRow('Parking', e.parking)}
                            ${_clDetailRow('Hire Equipment', e.hire)}
                            ${_clDetailRow('Logistics Notes', e.logisticsNotes)}
                            ${_clDetailRow('Budget / head', e.budgetPP)}
                            ${_clDetailRow('Total Budget', e.budgetTotal)}
                            ${_clDetailRow('Tasting', e.tasting)}
                            ${_clDetailRow('Timeline', e.timeline)}
                            ${_clDetailRow('Follow-up', e.followUp)}
                            ${_clDetailRow('Comparing', e.comparing)}
                            ${e.quoteTotal && e.quoteTotal !== '£0' ? `<div class="col-span-2" style="border-top:1px solid rgba(197,160,89,0.2);padding-top:0.75rem;margin-top:0.25rem;"><p class="font-sans text-[10px] uppercase tracking-widest text-gold/60 mb-0.5">Quote Total</p><p class="font-serif text-2xl text-gold">${e.quoteTotal}</p></div>` : ''}
                            ${e.menuItems && e.menuItems.length ? `<div class="col-span-3"><p class="font-sans text-[10px] uppercase tracking-widest text-cream/30 mb-1">Menu Ordered</p><p class="font-sans text-xs text-cream/65 leading-relaxed">${e.menuItems.map(i => i.name + ' (£' + i.price + 'pp)').join(' · ')}</p></div>` : ''}
                        </div>
                        ${e.summary ? `<div style="border-top:1px solid rgba(253,251,247,0.06);" class="pt-3 mt-1"><p class="font-sans text-[10px] uppercase tracking-widest text-cream/30 mb-1.5">Call Summary</p><p class="font-sans text-xs text-cream/65 leading-relaxed">${e.summary}</p></div>` : ''}
                    </div>
                </div>`;
            }).join('');
        }

        window.toggleCallDetail = function(id) {
            const el = document.getElementById('cl-detail-' + id);
            if (el) el.classList.toggle('hidden');
        };

        /* ═══════════════════════════════════════════════════════════
           MENU CATALOGUE + LIVE QUOTE CALCULATOR
        ═══════════════════════════════════════════════════════════ */

        const CL_DEFAULT_CATALOGUE = {
            'Canapés': [
                { id:101, name:'Jerk chicken skewer and plantain with sweet pepper', price:4 },
                { id:102, name:'Crispy Breaded King Prawns', price:4 },
                { id:103, name:'Fried Yam and Plantain Mix with Spicy Sauce', price:4 },
                { id:104, name:'Ackee and saltfish vol au vent', price:4 },
                { id:105, name:'Spring Rolls with Sweet Chilli Sauce', price:4 },
                { id:106, name:'Mini British Fish and Chips', price:4 },
                { id:107, name:'Chicken wings with warm spicy barbecue sauce', price:4 },
                { id:108, name:'Spicy gizzard and diced Plantains', price:4 },
                { id:109, name:'Crispy-fried chicken in butter mayo', price:4 },
                { id:110, name:'Mini Burgers', price:4 },
                { id:111, name:'Mini Mixed Meat Pies', price:4 },
                { id:112, name:'Mini Mixed Patties', price:4 },
                { id:113, name:'Puff Puff Bites', price:4 },
                { id:114, name:'Cooked prawns on a bed of lettuce', price:4 }
            ],
            'Starters': [
                { id:201, name:'Puff Puff', price:8 },
                { id:202, name:'Moyin Moyin', price:8 },
                { id:203, name:'Spicy gizzard', price:8 },
                { id:204, name:'Spicy Shish Kebab', price:8 },
                { id:205, name:'Fried Plantain & Smoked Salmon Sticks', price:8 },
                { id:206, name:'Assorted Meat or Fish Pepper Soup', price:8 },
                { id:207, name:'Spring Rolls with sauce', price:8 },
                { id:208, name:'Fermented oil bean seed (Ugba)', price:8 },
                { id:209, name:'Crispy Breaded King Prawns', price:8 },
                { id:210, name:'Cooked prawns on a bed of lettuce', price:8 },
                { id:211, name:'Chicken wings with warm spicy barbecue sauce', price:8 }
            ],
            'Nigerian Mains': [
                { id:301, name:'Jollof, Fried, Coconut or White Rice (with Plantain & Meat/Fish)', price:22 },
                { id:302, name:'Egusi, Eforiro, Ewedu, Ogbono, Edikaikong or Banga Soup', price:22 },
                { id:303, name:'Semolina, Pounded Yam, Garri, Amala or Ground Rice', price:22 },
                { id:304, name:'Roasted Potatoes with Roasted Lamb, Chicken or Turkey', price:22 },
                { id:305, name:'Boiled Yam and Tomato Omelette', price:22 },
                { id:306, name:'Dodo (Fried Plantain) with Omelette', price:22 },
                { id:307, name:'Asaro (Yam Porridge) and Dodo', price:22 }
            ],
            'Ghanaian Mains': [
                { id:401, name:'Banku with Okro Soup', price:22 },
                { id:402, name:'Kelewele (Spiced diced fried plantain)', price:22 },
                { id:403, name:'Fufu with Groundnut Soup', price:22 },
                { id:404, name:'Ghanaian-style Jollof Rice', price:22 },
                { id:405, name:'Kenkey (Fermented corn balls)', price:22 },
                { id:406, name:'Omo Tuo (Mashed rice balls with Sauce)', price:22 },
                { id:407, name:'Waakye (Rice and beans with Stew)', price:22 },
                { id:408, name:"Yam 'Ampesi' with De'Osa Sauce", price:22 },
                { id:409, name:'Shito Chicken Stew / Chicken Curry', price:22 },
                { id:410, name:'Goat Curry / Beef Stew / Beef Curry', price:22 },
                { id:411, name:'Fish Stew / Fish Curry (Croaker, Red Snapper or Tilapia)', price:22 }
            ],
            'Sierra Leonean': [
                { id:501, name:'Jollof Rice & stew with choice of meat', price:22 },
                { id:502, name:'Boneless chicken fried rice / Seafood fried rice', price:22 },
                { id:503, name:'Rice Sticks with choice of seafood, chicken or meat', price:22 },
                { id:504, name:'Groundnut stew with steamed rice', price:22 },
                { id:505, name:'Cassava leaves with meat/fish in palm oil', price:22 },
                { id:506, name:'Crain Crain with choice of meat/fish', price:22 },
                { id:507, name:'Potato leaves with choice of meat/fish', price:22 },
                { id:508, name:"Red palm oil stew with 'check rice'", price:22 },
                { id:509, name:'Fufu with choice of soup (Palm oil or Crain Crain)', price:22 }
            ],
            'Caribbean': [
                { id:601, name:'Jerk Chicken', price:20 },
                { id:602, name:'Jerk Chicken Wings', price:20 },
                { id:603, name:'Jerk Pork', price:20 },
                { id:604, name:'Curried Chicken', price:20 },
                { id:605, name:'Brown Stew Chicken', price:20 },
                { id:606, name:'Oxtail', price:20 },
                { id:607, name:'Pepper Steak', price:20 },
                { id:608, name:'Curry Goat', price:20 },
                { id:609, name:'Stew Shrimp', price:20 },
                { id:610, name:'Brown Stew Fish', price:20 },
                { id:611, name:'Escovitch Fish', price:20 },
                { id:612, name:'Curry Shrimp', price:20 },
                { id:613, name:'Callaloo', price:24 },
                { id:614, name:'Ackee & Cod Fish with Steamed Veg and Rice', price:24 }
            ],
            'Sides': [
                { id:701, name:'Plantains', price:5 },
                { id:702, name:'Fried Dumpling', price:5 },
                { id:703, name:'Wings', price:5 }
            ],
            'Desserts': [
                { id:801, name:'Fresh tropical fruit salad', price:7 },
                { id:802, name:'Banana cake and ice cream', price:7 },
                { id:803, name:'Chocolate Gateau', price:7 },
                { id:804, name:'Apple Pie with ice cream', price:7 },
                { id:805, name:'Rum Cake', price:7 },
                { id:806, name:'Banana Cake', price:7 },
                { id:807, name:'Chocolate Cake', price:7 },
                { id:808, name:'Ice Creams', price:7 }
            ]
        };

        const CL_SERVICE_RATES = {
            'Canapés & Drinks Only':  45,
            'Buffet Service':         65,
            'Family Style':           75,
            'Plated Multi-Course':    90,
            'Fine Dining':            120
        };

        const CL_ADDONS = [
            { id:'cl-ao1', name:'Staffing & Service',  price:2250, perEvent:true  },
            { id:'cl-ao2', name:'Tableware & Rentals', price:1100, perEvent:true  },
            { id:'cl-ao3', name:'Equipment Hire',      price:650,  perEvent:true  },
            { id:'cl-ao5', name:'Additional Staff',    price:150,  perEvent:false, unit:'per person', qtyId:'cl-ao5-qty' },
            { id:'cl-ao4', name:'Travel & Logistics',  price:2.50, perEvent:false, unit:'per mile',   qtyId:'cl-ao4-qty' }
        ];

        function _loadCatalogue() {
            try {
                const s = localStorage.getItem('mp_menuCatalogue');
                if (s) return JSON.parse(s);
            } catch (_) {}
            return CL_DEFAULT_CATALOGUE;
        }

        function _loadServiceRates() {
            try {
                const s = localStorage.getItem('mp_serviceStyles');
                if (s) {
                    const arr = JSON.parse(s);
                    const map = {};
                    arr.forEach(ss => { if (ss.name && ss.rate != null) map[ss.name] = ss.rate; });
                    return map;
                }
            } catch (_) {}
            return CL_SERVICE_RATES;
        }

        function renderMenuSection() {
            const catalogue = _loadCatalogue();
            const container = document.getElementById('cl-menu-courses');
            if (!container) return;

            container.innerHTML = Object.entries(catalogue).map(([course, items]) => {
                const active = (items || []).filter(i => i.active !== false);
                const ckey = course.replace(/[^a-z0-9]/gi, '_');
                return `
                <div class="rounded-lg overflow-hidden" style="border:1px solid rgba(255,255,255,0.08);">
                    <button type="button" onclick="toggleCourse('${ckey}')"
                        class="w-full flex items-center justify-between px-4 py-2.5 text-left transition-colors"
                        style="background:rgba(255,255,255,0.03);" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                        <div class="flex items-center gap-3">
                            <span class="font-sans text-[11px] font-bold uppercase tracking-widest" style="color:rgba(255,255,255,0.75);">${course}</span>
                            <span class="font-sans text-[10px]" style="color:rgba(255,255,255,0.25);">${active.length} items</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="font-sans text-[10px] text-gold" id="cl-ctotal-${ckey}"></span>
                            <svg class="w-3 h-3 transition-transform" id="cl-carrow-${ckey}" style="color:rgba(255,255,255,0.25);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </div>
                    </button>
                    <div class="hidden px-4 pb-2 pt-1" id="cl-citems-${ckey}">
                        ${active.map(item => `
                        <label class="flex items-center gap-3 py-1.5 cursor-pointer rounded px-1 -mx-1 transition-colors" style="color:rgba(255,255,255,0.65);"
                            onmouseover="this.style.color='rgba(255,255,255,0.9)'" onmouseout="this.style.color='rgba(255,255,255,0.65)'">
                            <input type="checkbox" id="cl-item-${item.id}" class="cl-menu-item w-3.5 h-3.5 shrink-0 accent-[#C5A059]"
                                data-price="${item.price}" data-course="${course}" data-name="${item.name.replace(/"/g,'&quot;')}"
                                onchange="updateQuote()">
                            <span class="font-sans text-xs flex-1 leading-snug">${item.name}</span>
                            <span class="font-sans text-[10px] shrink-0" style="color:rgba(197,160,89,0.7);">£${item.price}pp</span>
                        </label>`).join('')}
                    </div>
                </div>`;
            }).join('');

            /* Add-ons */
            const aoContainer = document.getElementById('cl-addon-list');
            if (aoContainer) {
                aoContainer.innerHTML = `
                <div class="rounded-lg overflow-hidden" style="border:1px solid rgba(255,255,255,0.08);">
                    <div class="px-4 py-2.5" style="background:rgba(255,255,255,0.03);border-bottom:1px solid rgba(255,255,255,0.07);">
                        <span class="font-sans text-[11px] font-bold uppercase tracking-widest" style="color:rgba(255,255,255,0.75);">Add-ons</span>
                    </div>
                    <div class="px-4 py-3 space-y-3">
                        ${CL_ADDONS.map(ao => `
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="${ao.id}" class="cl-addon w-3.5 h-3.5 shrink-0 accent-[#C5A059]" onchange="updateQuote()">
                            <label for="${ao.id}" class="font-sans text-xs flex-1 cursor-pointer" style="color:rgba(255,255,255,0.7);">${ao.name}</label>
                            ${!ao.perEvent ? `
                            <div class="flex items-center gap-1.5">
                                <input type="number" id="${ao.qtyId}" class="cl-input w-16 text-center py-1 px-2 text-xs" placeholder="${ao.unit === 'per mile' ? 'miles' : 'qty'}" min="0" oninput="updateQuote()">
                                <span class="font-sans text-[10px] whitespace-nowrap" style="color:rgba(255,255,255,0.3);">£${ao.price} ${ao.unit}</span>
                            </div>` : `<span class="font-sans text-[10px] shrink-0" style="color:rgba(197,160,89,0.7);">£${ao.price.toLocaleString()}</span>`}
                        </div>`).join('')}
                    </div>
                </div>`;
            }

            /* Wire guest count + service style to calculator */
            ['cl-guests','cl-service-style'].forEach(function(id) {
                const el = document.getElementById(id);
                if (!el) return;
                el.removeEventListener('input', updateQuote);
                el.removeEventListener('change', updateQuote);
                el.addEventListener('input', updateQuote);
                el.addEventListener('change', updateQuote);
            });
        }

        window.toggleCourse = function(ckey) {
            const panel = document.getElementById('cl-citems-' + ckey);
            const arrow = document.getElementById('cl-carrow-' + ckey);
            if (!panel) return;
            const hidden = panel.classList.toggle('hidden');
            if (arrow) arrow.style.transform = hidden ? '' : 'rotate(180deg)';
        };

        window.updateQuote = function() {
            const guests = parseInt(document.getElementById('cl-guests').value) || 0;
            const styleVal = document.getElementById('cl-service-style').value;
            const rates = _loadServiceRates();
            const serviceRate = rates[styleVal] || 0;
            const serviceBase = serviceRate * guests;

            /* Ticked menu items */
            const courseBreakdown = {};
            document.querySelectorAll('.cl-menu-item:checked').forEach(cb => {
                const price = parseFloat(cb.dataset.price) || 0;
                const course = cb.dataset.course;
                if (!courseBreakdown[course]) courseBreakdown[course] = { count:0, subtotal:0 };
                courseBreakdown[course].count++;
                courseBreakdown[course].subtotal += price * guests;
            });
            const menuTotal = Object.values(courseBreakdown).reduce((s, c) => s + c.subtotal, 0);

            /* Per-course totals in accordion headers */
            document.querySelectorAll('[id^="cl-ctotal-"]').forEach(el => { el.textContent = ''; });
            Object.entries(courseBreakdown).forEach(([course, data]) => {
                const ckey = course.replace(/[^a-z0-9]/gi, '_');
                const el = document.getElementById('cl-ctotal-' + ckey);
                if (el && data.count > 0) el.textContent = data.count + ' × £' + Math.round(data.subtotal).toLocaleString('en-GB');
            });

            /* Add-ons */
            let addOnsTotal = 0;
            const addOnLines = [];
            CL_ADDONS.forEach(ao => {
                const cb = document.getElementById(ao.id);
                if (!cb || !cb.checked) return;
                let cost = 0;
                if (!ao.perEvent) {
                    const qty = parseFloat((document.getElementById(ao.qtyId) || {}).value) || 0;
                    cost = ao.price * qty;
                } else {
                    cost = ao.price;
                }
                addOnsTotal += cost;
                addOnLines.push({ name: ao.name, cost });
            });

            const grand   = serviceBase + menuTotal + addOnsTotal;
            const deposit = grand * 0.25;
            const balance = grand * 0.75;
            const fmt = n => '£' + Math.round(n).toLocaleString('en-GB');

            document.getElementById('cl-grand-total').textContent = fmt(grand);
            document.getElementById('cl-deposit').textContent     = fmt(deposit);
            document.getElementById('cl-balance').textContent     = fmt(balance);

            /* Breakdown lines */
            const lines = [];
            if (serviceBase > 0) lines.push([styleVal + ' base (£' + serviceRate + 'pp × ' + guests + ')', fmt(serviceBase)]);
            Object.entries(courseBreakdown).forEach(([course, d]) =>
                lines.push([course + ' (' + d.count + ' item' + (d.count > 1 ? 's' : '') + ' × ' + guests + ' guests)', fmt(d.subtotal)]));
            addOnLines.forEach(l => lines.push([l.name, fmt(l.cost)]));

            const bd = document.getElementById('cl-quote-breakdown');
            if (lines.length === 0) {
                bd.innerHTML = '<p class="font-sans text-xs italic" style="color:rgba(255,255,255,0.25);">Select service style, guest count and menu items to generate a quote.</p>';
            } else {
                bd.innerHTML = lines.map(([label, val]) =>
                    `<div class="flex justify-between font-sans text-xs"><span style="color:rgba(255,255,255,0.4);">${label}</span><span style="color:rgba(255,255,255,0.75);">${val}</span></div>`
                ).join('') +
                `<div class="flex justify-between font-sans text-xs pt-2 mt-1 font-bold" style="border-top:1px solid rgba(197,160,89,0.2);">
                    <span style="color:rgba(255,255,255,0.8);">Grand Total</span><span style="color:#C5A059;">${fmt(grand)}</span>
                </div>
                <div class="flex justify-between font-sans text-xs"><span style="color:rgba(255,255,255,0.4);">Deposit (25%)</span><span style="color:rgba(255,255,255,0.7);">${fmt(deposit)}</span></div>
                <div class="flex justify-between font-sans text-xs"><span style="color:rgba(255,255,255,0.4);">Balance Due</span><span style="color:rgba(255,255,255,0.7);">${fmt(balance)}</span></div>`;
            }
        };

        window.toggleQuoteBreakdown = function() {
            const bd  = document.getElementById('cl-quote-breakdown');
            const btn = document.getElementById('cl-breakdown-toggle');
            const hidden = bd.classList.toggle('hidden');
            btn.textContent = hidden ? 'View Breakdown ↓' : 'Hide Breakdown ↑';
        };

        /* ── New Call Drawer ── */
        let _callTimer = null;
        let _callSeconds = 0;

        window.openNewCall = function() {
            // Reset all form fields
            document.getElementById('new-call-form').querySelectorAll('input, select, textarea').forEach(el => {
                if (el.type === 'checkbox') el.checked = false;
                else el.value = '';
            });
            document.getElementById('cl-summary').style.borderColor = '';
            // Render menu section and reset quote
            renderMenuSection();
            updateQuote();
            // Start elapsed timer
            _callSeconds = 0;
            clearInterval(_callTimer);
            _callTimer = setInterval(() => {
                _callSeconds++;
                const m = String(Math.floor(_callSeconds / 60)).padStart(2, '0');
                const s = String(_callSeconds % 60).padStart(2, '0');
                const el = document.getElementById('new-call-timer');
                if (el) el.textContent = m + ':' + s;
            }, 1000);
            const overlay = document.getElementById('new-call-overlay');
            const drawer  = document.getElementById('new-call-drawer');
            overlay.classList.remove('hidden');
            setTimeout(() => {
                overlay.classList.remove('opacity-0');
                drawer.classList.remove('drawer-closed');
                drawer.classList.add('drawer-open');
            }, 10);
        };

        window.closeNewCall = function() {
            clearInterval(_callTimer);
            const overlay = document.getElementById('new-call-overlay');
            const drawer  = document.getElementById('new-call-drawer');
            drawer.classList.remove('drawer-open');
            drawer.classList.add('drawer-closed');
            overlay.classList.add('opacity-0');
            setTimeout(() => overlay.classList.add('hidden'), 300);
        };

        window.saveNewCall = function() {
            const summary = document.getElementById('cl-summary').value.trim();
            const outcome = document.getElementById('cl-outcome').value;
            if (!summary) {
                const el = document.getElementById('cl-summary');
                el.style.borderColor = 'rgba(197,160,89,0.8)';
                el.focus(); return;
            }
            if (!outcome) { document.getElementById('cl-outcome').focus(); return; }

            const hire = ['tables','linens','crockery','glassware','furniture','none']
                .filter(h => document.getElementById('cl-hire-' + h).checked)
                .map(h => h.charAt(0).toUpperCase() + h.slice(1)).join(', ');

            const entry = {
                id:             Date.now(),
                name:           document.getElementById('cl-name').value.trim(),
                phone:          document.getElementById('cl-phone').value.trim(),
                email:          document.getElementById('cl-email').value.trim(),
                source:         document.getElementById('cl-source').value,
                time:           new Date().toISOString(),
                eventType:      document.getElementById('cl-event-type').value,
                eventDate:      document.getElementById('cl-event-date').value,
                eventStart:     document.getElementById('cl-event-start').value,
                eventEnd:       document.getElementById('cl-event-end').value,
                guests:         document.getElementById('cl-guests').value,
                venue:          document.getElementById('cl-venue').value.trim(),
                venueConfirmed: document.getElementById('cl-venue-confirmed').value,
                indoorOutdoor:  document.getElementById('cl-indoor-outdoor').value,
                kitchen:        document.getElementById('cl-kitchen').value,
                serviceStyle:   document.getElementById('cl-service-style').value,
                courses:        document.getElementById('cl-courses').value,
                canapes:        document.getElementById('cl-canapes').value,
                bar:            document.getElementById('cl-bar').value,
                cake:           document.getElementById('cl-cake').value,
                cuisine:        document.getElementById('cl-cuisine').value.trim(),
                starter:        document.getElementById('cl-starter').value.trim(),
                main:           document.getElementById('cl-main').value.trim(),
                dessert:        document.getElementById('cl-dessert').value.trim(),
                dietary:        document.getElementById('cl-dietary').value.trim(),
                arrival:        document.getElementById('cl-arrival').value,
                access:         document.getElementById('cl-access').value,
                parking:        document.getElementById('cl-parking').value,
                hire,
                logisticsNotes: document.getElementById('cl-logistics-notes').value.trim(),
                budgetPP:       document.getElementById('cl-budget-pp').value.trim(),
                budgetTotal:    document.getElementById('cl-budget-total').value.trim(),
                quoted:         document.getElementById('cl-quoted').value,
                tasting:        document.getElementById('cl-tasting').value,
                timeline:       document.getElementById('cl-timeline').value,
                followUp:       document.getElementById('cl-followup').value,
                comparing:      document.getElementById('cl-comparing').value,
                summary, outcome,
                menuItems: Array.from(document.querySelectorAll('.cl-menu-item:checked')).map(cb => ({
                    id: cb.id.replace('cl-item-',''), name: cb.dataset.name || '', price: parseFloat(cb.dataset.price), course: cb.dataset.course
                })),
                addOnsSelected: CL_ADDONS.filter(ao => document.getElementById(ao.id)?.checked).map(ao => ao.name),
                quoteTotal: (document.getElementById('cl-grand-total') || {}).textContent || ''
            };

            const log = loadCallLog();
            log.unshift(entry);
            persistCallLog(log);
            renderCallLog();
            closeNewCall();
        };

        document.addEventListener('DOMContentLoaded', renderCallLog);


    </script>

    <!-- New Call Overlay -->
    <div id="new-call-overlay" class="fixed inset-0 bg-charcoal/60 z-40 hidden transition-opacity opacity-0 backdrop-blur-sm"></div>

    <!-- New Call Intake Drawer -->
    <div id="new-call-drawer" class="fixed top-0 right-0 h-full w-full max-w-2xl z-50 drawer-closed transition-transform duration-300 flex flex-col border-l border-cream/10" style="background:#161616;">

        <!-- Header -->
        <div class="p-6 border-b border-cream/10 flex justify-between items-center shrink-0">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-full bg-gold/15 border border-gold/25 flex items-center justify-center text-gold shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                </div>
                <div>
                    <h3 class="font-serif text-2xl text-cream">New Call Intake</h3>
                    <p id="new-call-timer" class="font-sans text-[10px] text-gold/60 mt-0.5 tracking-widest tabular-nums">00:00</p>
                </div>
            </div>
            <button onclick="closeNewCall()" class="p-2 rounded-full text-cream/40 hover:text-gold hover:bg-cream/5 transition-colors border border-cream/10">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <!-- Scrollable Form -->
        <div class="flex-1 overflow-y-auto p-6" id="new-call-form">

            <!-- A: Caller Details -->
            <div class="cl-section">
                <p class="cl-section-hd">A — Caller Details</p>
                <div class="cl-grid-2">
                    <div><label class="cl-label">Name <span style="color:rgba(197,160,89,0.45);">(leave blank if anonymous)</span></label><input type="text" id="cl-name" class="cl-input" placeholder="Full name…"></div>
                    <div><label class="cl-label">Phone Number</label><input type="tel" id="cl-phone" class="cl-input" placeholder="07xxx xxx xxx"></div>
                    <div><label class="cl-label">Email Address</label><input type="email" id="cl-email" class="cl-input" placeholder="email@example.com"></div>
                    <div><label class="cl-label">How did they hear about De'Osa?</label>
                        <select id="cl-source" class="cl-input"><option value="">Select…</option><option>Website</option><option>Google</option><option>Instagram</option><option>Facebook</option><option>Referral</option><option>Word of Mouth</option><option>Previous Client</option><option>Press / Media</option><option>Other</option></select>
                    </div>
                </div>
            </div>

            <!-- B: Event Overview -->
            <div class="cl-section">
                <p class="cl-section-hd">B — Event Overview</p>
                <div class="cl-grid-2">
                    <div><label class="cl-label">Type of Event</label>
                        <select id="cl-event-type" class="cl-input"><option value="">Select…</option><option>Wedding</option><option>Corporate Gala</option><option>Private Party</option><option>Birthday</option><option>Anniversary</option><option>Christening</option><option>Baby Shower</option><option>Christmas Party</option><option>Product Launch</option><option>Awards Dinner</option><option>Networking Event</option><option>Dinner Party</option><option>Funeral Reception</option><option>Other</option></select>
                    </div>
                    <div><label class="cl-label">Event Date</label><input type="date" id="cl-event-date" class="cl-input"></div>
                    <div><label class="cl-label">Event Start Time</label><input type="time" id="cl-event-start" class="cl-input"></div>
                    <div><label class="cl-label">Event End Time</label><input type="time" id="cl-event-end" class="cl-input"></div>
                    <div><label class="cl-label">Number of Guests</label><input type="number" id="cl-guests" class="cl-input" placeholder="e.g. 120" min="1"></div>
                    <div><label class="cl-label">Venue Name / Location</label><input type="text" id="cl-venue" class="cl-input" placeholder="e.g. Syon Park, London"></div>
                    <div><label class="cl-label">Is the Venue Confirmed?</label>
                        <select id="cl-venue-confirmed" class="cl-input"><option value="">Select…</option><option>Yes – confirmed</option><option>Still looking</option><option>No – not decided</option></select>
                    </div>
                    <div><label class="cl-label">Indoor or Outdoor?</label>
                        <select id="cl-indoor-outdoor" class="cl-input"><option value="">Select…</option><option>Indoor</option><option>Outdoor</option><option>Both</option><option>Not decided</option></select>
                    </div>
                    <div><label class="cl-label">On-Site Kitchen?</label>
                        <select id="cl-kitchen" class="cl-input"><option value="">Select…</option><option>Full commercial kitchen</option><option>Basic facilities</option><option>None – we bring everything</option><option>Unknown</option></select>
                    </div>
                </div>
            </div>

            <!-- C: Menu & Service -->
            <div class="cl-section">
                <p class="cl-section-hd">C — Menu & Service</p>
                <div class="cl-grid-2">
                    <div><label class="cl-label">Service Style</label>
                        <select id="cl-service-style" class="cl-input"><option value="">Select…</option><option>Silver Plated</option><option>Buffet</option><option>Family Style</option><option>Canapés & Drinks Reception</option><option>Bowl Food</option><option>BBQ</option><option>Afternoon Tea</option><option>Grazing Table</option><option>Mixed / Multiple</option><option>Not decided</option></select>
                    </div>
                    <div><label class="cl-label">Number of Courses</label>
                        <select id="cl-courses" class="cl-input"><option value="">Select…</option><option>1 course</option><option>2 courses</option><option>3 courses</option><option>4+ courses</option><option>TBC</option></select>
                    </div>
                    <div><label class="cl-label">Canapés at Reception?</label>
                        <select id="cl-canapes" class="cl-input"><option value="">Select…</option><option>Yes</option><option>No</option><option>TBC</option></select>
                    </div>
                    <div><label class="cl-label">Bar / Drinks Service?</label>
                        <select id="cl-bar" class="cl-input"><option value="">Select…</option><option>Full bar</option><option>Wine & beer only</option><option>Soft drinks only</option><option>No</option><option>TBC</option></select>
                    </div>
                    <div><label class="cl-label">Wedding Cake Cutting & Serving?</label>
                        <select id="cl-cake" class="cl-input"><option value="">Select…</option><option>Yes</option><option>No</option><option>N/A</option></select>
                    </div>
                </div>
                <div class="mt-3 space-y-3">
                    <div><label class="cl-label">Cuisine Preference / Theme</label><input type="text" id="cl-cuisine" class="cl-input" placeholder="e.g. Mediterranean, British, Asian Fusion…"></div>
                    <div><label class="cl-label">Starter Ideas / Requests</label><input type="text" id="cl-starter" class="cl-input" placeholder="e.g. Burrata, Smoked salmon, Soup…"></div>
                    <div><label class="cl-label">Main Course Ideas / Requests</label><input type="text" id="cl-main" class="cl-input" placeholder="e.g. Herb-crusted lamb, Pan-seared sea bass…"></div>
                    <div><label class="cl-label">Dessert Ideas / Requests</label><input type="text" id="cl-dessert" class="cl-input" placeholder="e.g. Panna cotta, Chocolate fondant…"></div>
                    <div><label class="cl-label">Dietary Requirements & Allergies</label><textarea id="cl-dietary" class="cl-input" rows="2" placeholder="e.g. 4 vegetarian, 2 vegan, 1 nut allergy, 3 gluten-free, halal throughout…"></textarea></div>
                </div>
            </div>

            <!-- D: Staffing & Logistics -->
            <div class="cl-section">
                <p class="cl-section-hd">D — Staffing & Logistics</p>
                <div class="cl-grid-2">
                    <div><label class="cl-label">Team Arrival Time Available</label><input type="time" id="cl-arrival" class="cl-input"></div>
                    <div><label class="cl-label">Site Access</label>
                        <select id="cl-access" class="cl-input"><option value="">Select…</option><option>Easy – loading bay available</option><option>Limited access</option><option>Challenging</option><option>Unknown</option></select>
                    </div>
                    <div><label class="cl-label">Parking for Team?</label>
                        <select id="cl-parking" class="cl-input"><option value="">Select…</option><option>Yes</option><option>No</option><option>Unknown</option></select>
                    </div>
                </div>
                <div class="mt-3">
                    <label class="cl-label">Hire Equipment Needed</label>
                    <div class="flex flex-wrap gap-4 mt-1.5">
                        <label class="flex items-center gap-2 font-sans text-xs text-cream/55 cursor-pointer"><input type="checkbox" id="cl-hire-tables" class="accent-gold w-3.5 h-3.5"> Tables</label>
                        <label class="flex items-center gap-2 font-sans text-xs text-cream/55 cursor-pointer"><input type="checkbox" id="cl-hire-linens" class="accent-gold w-3.5 h-3.5"> Linens</label>
                        <label class="flex items-center gap-2 font-sans text-xs text-cream/55 cursor-pointer"><input type="checkbox" id="cl-hire-crockery" class="accent-gold w-3.5 h-3.5"> Crockery</label>
                        <label class="flex items-center gap-2 font-sans text-xs text-cream/55 cursor-pointer"><input type="checkbox" id="cl-hire-glassware" class="accent-gold w-3.5 h-3.5"> Glassware</label>
                        <label class="flex items-center gap-2 font-sans text-xs text-cream/55 cursor-pointer"><input type="checkbox" id="cl-hire-furniture" class="accent-gold w-3.5 h-3.5"> Furniture</label>
                        <label class="flex items-center gap-2 font-sans text-xs text-cream/55 cursor-pointer"><input type="checkbox" id="cl-hire-none" class="accent-gold w-3.5 h-3.5"> None</label>
                    </div>
                </div>
                <div class="mt-3"><label class="cl-label">Other Logistics Notes</label><input type="text" id="cl-logistics-notes" class="cl-input" placeholder="e.g. tight staircase, no lift, long walk from parking…"></div>
            </div>

            <!-- E: Budget & Next Steps -->
            <div class="cl-section">
                <p class="cl-section-hd">E — Budget & Next Steps</p>
                <div class="cl-grid-2">
                    <div><label class="cl-label">Budget Per Head</label><input type="text" id="cl-budget-pp" class="cl-input" placeholder="e.g. £80-100pp"></div>
                    <div><label class="cl-label">Overall Budget</label><input type="text" id="cl-budget-total" class="cl-input" placeholder="e.g. £15,000"></div>
                    <div><label class="cl-label">Quoted Before?</label>
                        <select id="cl-quoted" class="cl-input"><option value="">Select…</option><option>Yes</option><option>No</option></select>
                    </div>
                    <div><label class="cl-label">Interested in a Tasting?</label>
                        <select id="cl-tasting" class="cl-input"><option value="">Select…</option><option>Yes</option><option>No</option><option>Maybe</option></select>
                    </div>
                    <div><label class="cl-label">Decision Timeline</label>
                        <select id="cl-timeline" class="cl-input"><option value="">Select…</option><option>ASAP</option><option>Within 1-2 weeks</option><option>Within 1 month</option><option>3+ months</option><option>Unknown</option></select>
                    </div>
                    <div><label class="cl-label">Preferred Follow-Up</label>
                        <select id="cl-followup" class="cl-input"><option value="">Select…</option><option>Email</option><option>Phone</option><option>WhatsApp</option><option>Any</option></select>
                    </div>
                    <div><label class="cl-label">Comparing Other Caterers?</label>
                        <select id="cl-comparing" class="cl-input"><option value="">Select…</option><option>Yes</option><option>No</option><option>Unknown</option></select>
                    </div>
                </div>
            </div>

            <!-- G: Menu Selection -->
            <div class="cl-section">
                <p class="cl-section-hd">G — Menu Selection & Quote</p>
                <p class="font-sans text-[10px] mb-4 -mt-2" style="color:rgba(255,255,255,0.35);">Guest count &amp; service style sync from sections above. Tick items to build a live quote.</p>
                <div id="cl-menu-courses" class="space-y-1.5"><!-- rendered by JS --></div>
                <div id="cl-addon-list" class="mt-3 space-y-1.5"><!-- rendered by JS --></div>
            </div>

            <!-- F: Call Summary & Outcome -->
            <div>
                <p class="cl-section-hd">F — Call Summary & Outcome</p>
                <div class="space-y-3">
                    <div><label class="cl-label">Call Notes / Summary <span style="color:rgba(197,160,89,0.7);">*</span></label><textarea id="cl-summary" class="cl-input" rows="5" placeholder="Summarise the conversation, client preferences, decisions made, and any follow-up agreed…"></textarea></div>
                    <div><label class="cl-label">Call Outcome <span style="color:rgba(197,160,89,0.7);">*</span></label>
                        <select id="cl-outcome" class="cl-input"><option value="">Select outcome…</option><option>Booking Confirmed</option><option>Quote Requested</option><option>Tasting Scheduled</option><option>Information Sent</option><option>Callback Required</option><option>No Interest</option></select>
                    </div>
                </div>
            </div>

        </div><!-- /form body -->

        <!-- ── Live Quote Panel (always visible) ── -->
        <div id="cl-quote-panel" class="shrink-0 border-t border-gold/20 px-6 pt-4 pb-3" style="background:rgba(197,160,89,0.06);">
            <div class="flex items-center justify-between mb-3">
                <p class="font-sans text-[10px] font-bold uppercase tracking-widest" style="color:#C5A059;">Live Quote</p>
                <button type="button" onclick="toggleQuoteBreakdown()" id="cl-breakdown-toggle" class="font-sans text-[10px] uppercase tracking-widest transition-colors" style="color:rgba(255,255,255,0.35);">View Breakdown ↓</button>
            </div>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <p class="font-sans text-[10px] uppercase tracking-widest mb-1" style="color:rgba(255,255,255,0.3);">Grand Total</p>
                    <p class="font-serif text-2xl" style="color:#C5A059;" id="cl-grand-total">£0</p>
                </div>
                <div>
                    <p class="font-sans text-[10px] uppercase tracking-widest mb-1" style="color:rgba(255,255,255,0.3);">Deposit (25%)</p>
                    <p class="font-sans text-base font-semibold" style="color:rgba(255,255,255,0.7);" id="cl-deposit">£0</p>
                </div>
                <div>
                    <p class="font-sans text-[10px] uppercase tracking-widest mb-1" style="color:rgba(255,255,255,0.3);">Balance Due</p>
                    <p class="font-sans text-base font-semibold" style="color:rgba(255,255,255,0.7);" id="cl-balance">£0</p>
                </div>
            </div>
            <!-- Expandable line-by-line breakdown -->
            <div id="cl-quote-breakdown" class="hidden mt-3 pt-3 space-y-1 overflow-y-auto" style="border-top:1px solid rgba(197,160,89,0.2);max-height:160px;">
                <p class="font-sans text-xs italic" style="color:rgba(255,255,255,0.25);">Select service style, guest count and menu items to generate a quote.</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="p-5 border-t border-cream/10 flex gap-3 shrink-0">
            <button onclick="closeNewCall()" class="flex-1 py-3 bg-cream/5 border border-cream/15 text-cream/60 rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:border-cream/30 hover:text-cream transition-all">Cancel</button>
            <button onclick="saveNewCall()" class="flex-1 py-3 bg-gold/20 border border-gold/40 text-gold rounded-lg font-sans text-[10px] font-bold uppercase tracking-widest hover:bg-gold hover:text-charcoal transition-all">Save Call</button>
        </div>
    </div>

    <!-- Comms Sheet Overlay -->
    <div id="comms-overlay" class="fixed inset-0 z-40 hidden opacity-0 transition-opacity duration-300 backdrop-blur-sm" style="background:rgba(28,28,28,0.75);" onclick="closeCommsSheet()"></div>

    <!-- Comms Bottom Sheet -->
    <div id="comms-sheet" class="fixed bottom-0 left-0 right-0 z-50 flex flex-col" style="background:#161616; border-top:1px solid rgba(197,160,89,0.2); border-radius:1rem 1rem 0 0; transform:translateY(100%); transition:transform 0.38s cubic-bezier(0.32,0.72,0,1); max-height:70vh;">

        <!-- Handle -->
        <div class="flex justify-center pt-3 pb-1 shrink-0">
            <div class="w-10 h-1 rounded-full" style="background:rgba(253,251,247,0.15);"></div>
        </div>

        <!-- Header -->
        <div class="px-6 py-4 flex justify-between items-center shrink-0" style="border-bottom:1px solid rgba(253,251,247,0.08);">
            <div>
                <h3 id="comms-sheet-title" class="font-serif text-2xl text-cream">Text Message</h3>
                <p id="comms-sheet-sub" class="font-sans text-xs mt-0.5" style="color:rgba(253,251,247,0.35);"></p>
            </div>
            <button onclick="closeCommsSheet()" class="p-2 rounded-full text-cream/40 hover:text-gold hover:bg-cream/5 transition-colors border border-cream/10">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto px-6 py-5" id="comms-sheet-body"></div>
    </div>

    <script>
        /* ─── Theme Toggle ─── */
        const LOGOS = { dark: 'images/logo-dark-bg.svg', light: 'images/logo-light.svg' };

        function applyTheme(theme) {
            const isLight = theme === 'light';
            document.documentElement.setAttribute('data-theme', theme);
            // Icons
            document.getElementById('theme-icon-moon').classList.toggle('hidden', isLight);
            document.getElementById('theme-icon-sun').classList.toggle('hidden', !isLight);
            // Logos
            const logo = isLight ? LOGOS.light : LOGOS.dark;
            document.getElementById('sidebar-logo').src = logo;
            document.getElementById('mobile-logo').src  = logo;
            // Metric period inline styles need refreshing for correct inactive colour
            const activePeriodBtn = document.querySelector('.metric-period[data-active="true"]');
            if (activePeriodBtn) {
                const inactiveColor  = isLight ? 'rgba(28,28,28,0.4)'  : 'rgba(253,251,247,0.35)';
                const inactiveBorder = isLight ? 'rgba(28,28,28,0.12)' : 'rgba(253,251,247,0.1)';
                document.querySelectorAll('.metric-period').forEach(btn => {
                    const active = btn === activePeriodBtn;
                    if (!active) {
                        btn.style.color       = inactiveColor;
                        btn.style.borderColor = inactiveBorder;
                        btn.style.background  = 'transparent';
                    }
                });
            }
            localStorage.setItem('admin-theme', theme);
        }

        window.toggleTheme = function() {
            const current = document.documentElement.getAttribute('data-theme') || 'dark';
            applyTheme(current === 'light' ? 'dark' : 'light');
        };

        // Patch setMetricPeriod to use theme-aware colours
        const _origSetMetricPeriod = window.setMetricPeriod || null;
        document.addEventListener('DOMContentLoaded', () => {
            const origFn = setMetricPeriod;
            setMetricPeriod = function(period) {
                origFn(period);
                // Mark active button for theme switcher reference
                document.querySelectorAll('.metric-period').forEach(btn => {
                    btn.dataset.active = btn.dataset.period === period ? 'true' : 'false';
                });
                // Re-apply inactive colour for current theme
                const isLight = document.documentElement.getAttribute('data-theme') === 'light';
                const inactiveColor  = isLight ? 'rgba(28,28,28,0.4)'  : 'rgba(253,251,247,0.35)';
                const inactiveBorder = isLight ? 'rgba(28,28,28,0.12)' : 'rgba(253,251,247,0.1)';
                document.querySelectorAll('.metric-period').forEach(btn => {
                    if (btn.dataset.period !== period) {
                        btn.style.color       = inactiveColor;
                        btn.style.borderColor = inactiveBorder;
                        btn.style.background  = 'transparent';
                    }
                });
            };

            // Load saved theme
            const saved = localStorage.getItem('admin-theme') || 'dark';
            applyTheme(saved);
        });
    </script>

</body>
</html>
